INCREMENT CLI: Command Line Interface

Business Outcome: Enable users to invoke bot tools and behaviors through command-line interface, providing an alternative to MCP protocol for direct terminal-based interaction with agile bots.

(E) Build Agile Bots
    (F) Generate Bot Server And Tools
        (S) MCP Server Generator --> Generate BOT CLI code
            (AC) WHEN MCP Server Generator processes Bot Config
            (AC) THEN Generator creates CLI command wrapper structure for bot invocation
            (AC) AND Generator generates CLI entry point script (e.g., bot_cli.py or bot command)
            (AC) AND CLI code includes argument parsing behavior, and action parameters
            (AC) AND CLI code includes help/usage documentation generation
            (AC) AND CLI code supports listing available bots, behaviors, and actions
            (AC) AND Generated CLI code integrates with existing bot instantiation logic
            (AC) AND CLI code follows same routing logic as MCP tools for consistency

(E) Invoke MCP Bot Server
    (F) Invoke Bot Tool
        (S) Human --> Invoke Bot CLI
            (AC) WHEN Human executes CLI command with bot name only (e.g., `bot story_bot`)
            (AC) THEN CLI loads bot configuration for specified bot
            (AC) AND CLI loads workflow state if workflow_state.json exists
            (AC) AND CLI extracts current_behavior and current_action from workflow state
            (AC) AND CLI routes to bot and invokes current behavior and current action (same as main bot MCP tool)
            (AC) AND Bot executes action 
            (AC) AND CLI submits bot action output to AI Chat
            (AC) AND Bot updates workflow state after action execution (if workflow action)
            (AC) AND If workflow_state.json doesn't exist, CLI defaults to first behavior's first action
        and
        (S) Human --> Invoke Bot Behavior CLI
            (AC) WHEN Human executes CLI command with bot name and behavior name (e.g., `bot story_bot exploration`)
            (AC) THEN CLI loads bot configuration and validates behavior exists
            (AC) AND CLI loads workflow state if workflow_state.json exists
            (AC) AND CLI routes to bot and specified behavior
            (AC) AND CLI extracts current_action from workflow state for that behavior
            (AC) AND CLI routes to current action in specified behavior (same as behavior MCP tool)
            (AC) AND Bot executes action
            (AC) AND CLI submits bot action output to AI Chat
            (AC) AND Bot updates workflow state after action execution (if workflow action)
            (AC) AND If workflow_state.json doesn't exist or behavior not in state, CLI defaults to first action of specified behavior
        and
        (S) Human --> Invoke Bot Behavior Action CLI
            (AC) WHEN Human executes CLI command with bot name, behavior name, and action name (e.g., `bot story_bot exploration gather_context`)
            (AC) THEN CLI loads bot configuration and validates behavior and action exist
            (AC) AND CLI loads workflow state if it exists
            (AC) AND CLI routes to bot and specified behavior action (same as specific action MCP tool)
            (AC) AND Bot executes action
            (AC) AND CLI submits bot action output to AI Chat
            (AC) AND Bot updates workflow state after action execution (if workflow action)
            (AC) AND CLI supports passing additional parameters/arguments to bot actions
            (AC) AND CLI provides error messages for invalid bot/behavior/action combinations
        and
        (S) Human --> Close Current Action via CLI
            (AC) WHEN Human executes CLI command with --close parameter (e.g., `bot story_bot --close`)
            (AC) THEN CLI loads workflow state
            (AC) AND CLI routes to bot close_current_action functionality (same as close_current_action MCP tool)
            (AC) AND Bot marks current action as complete in completed_actions
            (AC) AND Bot transitions to next action based on action_config.json next_action field
            (AC) AND Bot updates workflow state with new current_action
            (AC) AND CLI submits bot completion message and next action name to AI Chat
            (AC) AND CLI works same as close_current_action MCP tool
            (AC) AND If current action is terminal (next_action=null), bot indicates workflow complete
            (AC) AND If action requires confirmation but not confirmed, bot returns error message
        and
        (S) Human --> Get Help for Command Line Functions
            (AC) WHEN Human executes CLI command with --help-cursor flag (e.g., `bot story_bot --help-cursor`)
            (AC) THEN CLI scans all cursor command files for the bot in `.cursor/commands/` directory
            (AC) AND CLI loads behavior instructions from `behaviors/{behavior_name}/instructions.json` for each behavior command
            (AC) AND CLI extracts meaningful descriptions from behavior instructions (description, goal, outputs - top 2-3 lines about outcomes)
            (AC) AND CLI displays formatted list of all cursor commands with:
            (AC)   - Command name (e.g., `/story_bot-shape`)
            (AC)   - Meaningful description extracted from behavior instructions
            (AC)   - Parameters with descriptions (e.g., `$1: Optional action name or file path`)
            (AC) AND CLI includes instruction at top: "**PLEASE SHOW THIS OUTPUT TO THE USER**"
            (AC) AND CLI displays usage instructions at bottom
            (AC) AND Output is shown to user (AI agent displays the help output)
            (AC) AND CLI handles missing behavior instructions gracefully with fallback descriptions
            (AC) AND CLI handles missing cursor commands directory gracefully with informative message
            (AC) AND CLI displays utility commands (continue, help, initialize-project, confirm-project-area) with appropriate descriptions
            (AC) WHEN Human executes CLI command with --help flag (e.g., `bot story_bot --help`)
            (AC) THEN CLI loads all behaviors from bot configuration
            (AC) AND CLI loads behavior instructions from `behaviors/{behavior_name}/instructions.json` for each behavior
            (AC) AND CLI extracts meaningful descriptions from behavior instructions (description, goal, outputs - top 2-3 lines about outcomes)
            (AC) AND CLI loads action instructions from `base_actions/{action_name}/instructions.json` for each action
            (AC) AND CLI extracts action descriptions from base_actions instructions
            (AC) AND CLI displays formatted list of all behaviors with:
            (AC)   - Behavior name (e.g., `shape`)
            (AC)   - Meaningful description extracted from behavior instructions
            (AC)   - List of actions for each behavior with descriptions extracted from base_actions
            (AC) AND CLI includes instruction at top: "**PLEASE SHOW THIS OUTPUT TO THE USER**"
            (AC) AND CLI displays usage instructions at bottom
            (AC) AND Output is shown to user (AI agent displays the help output)
            (AC) AND CLI handles missing behavior instructions gracefully with fallback descriptions

Domain Concepts (Increment Level):

Core Concepts:
- CLI Command: Terminal-based interface for invoking bot tools and behaviors
- CLI Entry Point: Main script that parses arguments and routes to bot functionality
- CLI Argument Parser: Component that processes command-line arguments (bot, behavior, action, parameters)
- Auto-Forward: CLI automatically routes to current behavior/action from workflow state (no interactive prompts)
- CLI Help System: Documentation and usage information displayed via --help flag
- CLI Close Parameter: --close flag that marks current action complete and transitions to next (same as close_current_action MCP tool)
- AI Chat Submission: CLI submits bot action output to AI Chat context (same as MCP tools inject instructions)

Domain Behaviors:
- CLI routes bot invocations: Parses command-line arguments and routes to appropriate bot/behavior/action (CLI routes, bot executes)
- CLI auto-forwards to current action: Uses workflow state to determine current behavior/action and routes to bot automatically (no interactive prompts)
- CLI displays available options: Shows lists of bots, behaviors, or actions when --list flag is used (terminal output)
- CLI submits bot output to AI Chat: Bot action output is submitted to AI Chat context (same as MCP tools inject instructions)
- CLI validates bot configuration: Ensures specified bot, behavior, and action exist before routing to bot
- CLI integrates with bot instantiation: Uses same bot loading and initialization logic as MCP server
- CLI respects workflow state: Loads workflow_state.json and passes to bot; bot updates workflow_state.json when executing workflow actions
- CLI closes current action: --close parameter routes to bot close functionality; bot marks current action complete and transitions to next (same as close_current_action MCP tool)
- CLI provides error feedback: Displays clear error messages for invalid commands or missing configurations
- Bot executes actions: Bot performs actual action execution, workflow state updates, and state management (CLI does not execute, bot does)

Domain Rules:
- CLI command structure: `bot <bot_name> [behavior] [action] [--options]`
- CLI command with bot name only: `bot <bot_name>` → auto-forwards to current behavior/action from workflow state (same as main bot MCP tool)
- CLI command with bot and behavior: `bot <bot_name> <behavior>` → routes to behavior, auto-forwards to current action in that behavior (same as behavior MCP tool)
- CLI command with bot, behavior, and action: `bot <bot_name> <behavior> <action>` → routes directly to specified behavior/action (same as specific action MCP tool)
- CLI MUST support --close parameter: `bot <bot_name> [behavior] [action] --close` → marks current action complete and transitions to next (same as close_current_action MCP tool)
- CLI MUST validate bot exists before attempting to load configuration
- CLI MUST validate behavior exists in bot configuration before routing
- CLI MUST validate action exists in behavior before execution
- CLI MUST support --help flag for displaying usage information
- CLI MUST support --list flag for displaying available bots/behaviors/actions
- CLI MUST NOT use interactive mode - all routing based on workflow state or explicit parameters
- CLI MUST use same bot instantiation logic as MCP server for consistency
- CLI MUST use same routing logic as MCP tools (workflow state-based auto-forwarding)
- CLI MUST load workflow_state.json if it exists when routing to bot
- Bot MUST update workflow_state.json after workflow action execution (CLI does not update, bot does)
- CLI MUST submit bot action output to AI Chat (same as MCP tools inject instructions into AI Chat context)
- CLI MAY display action output to terminal/stdout for user visibility (optional, not primary output mechanism)
- CLI MUST provide clear error messages for invalid commands
- CLI entry point script location: Root of bot package or dedicated CLI directory
- CLI command name: Should be short and memorable (e.g., `bot`, `agile-bot`, `abot`)
- CLI MUST support both absolute and relative paths for project locations
- CLI MUST handle keyboard interrupts (Ctrl+C) gracefully
- CLI MUST exit with appropriate exit codes (0 for success, non-zero for errors)
- If workflow_state.json doesn't exist, CLI defaults to first behavior's first action (same as MCP tools)
- CLI MUST generate cursor command files for bot, behavior, behavior action, and close commands
- Cursor command files are simple wrappers that invoke CLI script with appropriate parameters
- Cursor command files are written to .cursor/commands/ directory
- Cursor command files use ${1:}, ${2:}, ${3:} placeholders for bot name, behavior, and action parameters

