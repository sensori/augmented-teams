# Consolidated Function Mapping Table

This document maps existing test helper functions to their new consolidated, parameterized equivalents. Each row shows ONE consolidated function that replaces MANY existing functions.

## PERFORM BEHAVIOR ACTION Sub-Epic

| New Consolidated Function | Existing Functions (comma-delimited) |
|--------------------------|--------------------------------------|
| `then_state_matches(state_file, bot_name, behavior, current_action=None, completed_actions=None, completed_count=None, min_completed_count=None, action_completed=None, action_not_completed=None, actions_removed_after=None)` | `then_action_is_marked_complete(state_file, bot_name, behavior, action)`, `then_completed_actions_count_is(state_file, expected_count)`, `then_current_action_is(state_file, bot_name, behavior, expected_action)`, `then_action_is_saved_to_completed_actions(state_file, bot_name, behavior, action)`, `then_completed_actions_count_is_at_least(state_file, min_count)`, `then_workflow_state_shows_action(state_file, bot_name, behavior, action)`, `then_workflow_state_shows_behavior(state_file, bot_name, behavior)`, `then_completed_actions_do_not_include(workflow_file, bot_name, behavior, action_name)`, `then_completed_actions_removed_after_target(state_file, bot_name, behavior, target_action)`, `then_verify_completed_actions_after_navigation(state_file, bot_name, behavior)`, `given_action_is_not_completed(state_file, bot_name, behavior, action)`, `given_initial_completed_action_count(state_file, action_name)`, `then_action_is_completed(workflow, action_name)` |
| `then_bot_state_matches(bot, current_action=None, behavior=None)` | `then_workflow_current_state_is(bot, expected_action)`, `then_workflow_transitions_to_next_action(bot, expected_action)`, `then_workflow_stays_at_action(bot, expected_action)`, `then_current_state_is(bot, expected_action)`, `then_workflow_current_state_is_build_knowledge(bot)`, `then_workflow_current_state_is_gather_context(bot)`, `then_workflow_current_state_is_decide_planning_criteria(bot)` |
| `when_workflow_navigates(bot, behavior_name=None, action_name=None, out_of_order=False)` | `given_behavior_is_at_action(bot, behavior_name, action_name)`, `given_workflow_is_at_action(bot, action_name)`, `when_navigate_to_target_action_out_of_order(bot, behavior_name, target_action)` |
| `when_action_closes(bot, behavior_name=None, action_name=None)` | `when_user_closes_current_action(bot, behavior_name)`, `when_user_closes_current_action_and_transitions(bot, action_name)`, `when_close_already_completed_action(bot, action_name)`, `when_action_is_closed_and_transitioned(bot, behavior_name, action_name)`, `when_close_shape_gather_context_and_verify(bot)`, `when_close_discovery_gather_context_and_verify(bot)` |
| `when_action_executes(action_type, bot_directory, behavior, action_name=None, **action_params)` | `when_action_is_executed(bot, behavior_name, action_name)`, `when_validate_action_executes(bot_directory, behavior, action_name)`, `when_render_output_action_executes(bot_directory, behavior)`, `when_execute_shape_gather_context_and_verify(bot, state_file, bot_name)`, `when_execute_discovery_gather_context_and_verify(bot, state_file, bot_name)` |
| `given_environment_setup(bot_directory, workspace_directory, behaviors, bot_name='story_bot', current_action=None, completed_actions=None, is_final_action=False, is_last_behavior=False, create_guardrails=True, create_kg_config=False, create_state_file=True, behavior_config=None, resume_workflow=False, guardrails_malformed=False)` | `given_environment_setup_for_final_action_test(bot_directory, workspace_directory, behaviors)`, `given_environment_setup_for_non_final_action_test(bot_directory, workspace_directory, behaviors)`, `given_environment_setup_for_last_behavior_test(bot_directory, workspace_directory, behaviors)`, `given_test_environment_setup(bot_directory, workspace_directory, bot_name, behaviors)`, `given_environment_and_empty_behavior_action_state(bot_directory, workspace_directory, bot_name, behavior, completed)`, `given_environment_behavior_action_state_and_bot(bot_directory, workspace_directory, bot_name, behavior, current_action, completed)`, `given_behavior_action_state_file_with_completed_actions(workspace_directory, bot_name, behavior, current_action, completed_actions)`, `given_workflow_state_file_with_empty_current_action(workspace_directory, bot_name, behavior, completed_actions)`, `given_workflow_state_with_completed_actions(workspace_directory, bot_name, behavior, current_action, completed_actions)`, `when_create_behavior_action_state_with_current_action(bot_directory, workspace_directory, bot_name, behavior, current_action, completed)`, `given_environment_and_verify_no_state_file(bot_directory, workspace_directory)`, `given_environment_and_bot(tmp_path, bot_name)`, `given_environment_and_behavior_config(bot_directory, workspace_directory, behavior, behavior_config)`, `given_environment_and_behavior_directory(bot_directory, workspace_directory, behavior)`, `given_bot_name_behaviors_and_config_setup(bot_directory, workspace_directory)`, `given_bot_config_and_behavior_setup(bot_directory, bot_name, behaviors)`, `given_bot_environment_bootstrapped(bot_directory, workspace_directory)`, `when_bot_and_workflow_file_created(bot_name, bot_directory, config_path, workspace_directory)`, `given_environment_bootstrapped_for_workflow_resume(bot_directory, workspace_directory)` |
| `given_completed_action(bot_name, behavior, action, timestamp=None)` | `given_completed_action_for_behavior(bot_name, behavior, action, timestamp)`, `given_completed_action_for_gather_context(bot_name, behavior)`, `given_completed_action_entry_for_behavior(bot_name, behavior, action, timestamp)` |
| `given_completed_actions(bot_name, behaviors, actions)` | `given_completed_actions_for_behaviors(bot_name, behaviors, action)`, `given_completed_actions_for_three_actions(bot_name, behavior)`, `given_completed_actions_for_four_actions(bot_name, behavior)` |
| `then_instructions_contain(result, reminder_type=None, check_prompt=False, guardrails=None, strategy=None, template_path=None, fields=None)` | `then_base_instructions_include_next_behavior_reminder(action_result)`, `then_reminder_contains_prompt_text(base_instructions_list)`, `then_instructions_contain_guardrails(instructions, expected_questions, expected_evidence)`, `then_instructions_contain_strategy_criteria_and_assumptions(instructions, expected_assumptions)`, `then_instructions_contain_template_path(instructions, template_name)`, `then_instructions_contain_validation_rules(instructions)`, `then_render_configs_include_all_required_fields(base_instructions_text)`, `then_specific_field_values_present(base_instructions_text)` |
| `then_instructions_do_not_contain(result, reminder_type=None, content=None)` | `then_base_instructions_do_not_include_next_behavior_reminder(action_result)`, `then_instructions_do_not_contain_guardrails(instructions)`, `then_instructions_do_not_contain_strategy_data(instructions)`, `then_no_next_action_instructions_injected(instructions)` |
| `given_workflow_config(bot_directory, behaviors=None, actions=None, final_action=None, states=None, transitions=None)` | `given_standard_workflow_states(bot_directory)`, `given_standard_workflow_actions_config(bot_directory)`, `given_action_configs_exist_for_workflow_actions(bot_directory, workflow_actions)`, `given_base_actions_exist_with_transitions(bot_directory)`, `given_behaviors_exist_with_workflow(bot_directory, behaviors)`, `given_behavior_workflow_with_validate_as_final(bot_directory, behavior_name)`, `given_workflow_created(bot_name, behavior, bot_directory, states, transitions)`, `when_create_workflow_with_states_and_transitions(bot_name, behavior, bot_directory, states, transitions)`, `given_standard_workflow_states_and_transitions()`, `given_standard_states_and_transitions()`, `given_expected_transitions_list()` |
| `given_action_config(bot_directory, action, is_final=None, save_report=None, order=None, next_action=None)` | `given_base_action_instructions_exist_for_validate(bot_directory)`, `given_base_action_instructions_exist_for_validate_not_final(bot_directory)`, `given_base_action_instructions_exist_for_render_output(bot_directory)`, `given_terminal_action_config(bot_directory, action_name, order)`, `given_base_action_instructions_for_validate(bot_directory, save_report_instruction)` |
| `given_file_created(directory, filename, content, file_type='text')` | `given_behavior_json_file_created(behavior_dir, behavior_config)`, `given_story_graph_file_exists(workspace_directory)`, `given_story_graph_file_with_content(workspace_directory, story_graph)`, `given_story_graph_file_with_invalid_json(workspace_directory)`, `given_test_file_created_with_content(workspace_directory, filename, content)`, `given_test_file_for_validate_code_files_action(workspace_directory, filename)`, `given_source_file_for_validate_code_files_action(workspace_directory, filename)`, `given_knowledge_graph_file_created(workspace_directory, knowledge_graph)`, `given_story_graph_file_created(docs_dir_or_workspace, story_graph)`, `given_existing_story_graph_created(workspace_directory, story_graph_content)`, `given_knowledge_graph_config_file_created(kg_dir, template_name)`, `given_knowledge_graph_template_file_created(kg_dir, template_name, template_content)`, `given_knowledge_graph_config_for_increments_created(kg_dir, config_data)`, `given_knowledge_graph_template_for_increments_created(kg_dir, template_content)`, `given_knowledge_graph_config_for_story_graph_increments(kg_dir)`, `given_knowledge_graph_template_for_increments(kg_dir)`, `given_knowledge_graph_template_with_schema_created(kg_dir)`, `given_test_file_for_scanner_type(workspace_directory, scanner_class_path, behavior)`, `when_create_knowledge_behavior_file(bot_directory, knowledge_behavior, knowledge_behavior_config)`, `when_create_code_behavior_file(bot_directory, code_behavior, code_behavior_config)`, `when_create_behavior_file_with_config(bot_directory, behavior, behavior_config)` |
| `given_files_created(directory, filenames, file_type='text')` | `given_test_files_for_validate_code_files_action(workspace_directory)`, `given_source_files_for_validate_code_files_action(workspace_directory)` |
| `then_result_matches(result, action=None, behavior=None, next_action=None, has_key=None, has_violations=None, error_message=None, violations_source=None, bot_name=None)` | `then_action_result_has_correct_action(result, expected_action)`, `then_action_result_has_correct_behavior_and_action(result, expected_behavior, expected_action)`, `then_no_next_action_in_result(result)`, `then_result_contains_instructions_key(result)`, `then_result_has_violations_or_report(result, error_message)`, `then_result_has_violations_from_knowledge_graph(result)`, `then_action_has_correct_bot_name_and_behavior(action, expected_bot_name, expected_behavior)` |
| `then_behavior_states_match(behavior_instance, expected_states)` | `then_workflow_states_match(behavior_instance, expected_states)`, `then_workflow_states_match_expected(behavior_instance, expected_states)` |
| `then_behavior_transitions_match(behavior_instance, expected_transitions)` | `then_workflow_transitions_match(behavior_instance, expected_transitions)`, `then_transitions_match_expected(behavior_instance, expected_transitions)`, `then_transition_dict_matches_expected(behavior_instance)` |
| `then_state_matches_multiple_behaviors(state_file, bot_name)` | `then_verify_completed_actions_across_behaviors(state_file, bot_name)`, `then_all_completed_actions_tracked_across_behaviors()` |
| `when_workflow_executes_and_verifies(bot, state_file, bot_name)` | `when_execute_workflow_steps_and_verify_completion(test_instance, bot, state_file, bot_name)` |
| `given_behavior_config(bot_directory, behavior, config=None, bot_name=None, final_action=None, description=None, goal=None)` | `given_behavior_config_created(bot_directory, behavior, behavior_config)`, `given_behavior_directory_created(bot_directory, behavior)`, `given_knowledge_behavior_config()`, `given_code_behavior_config()`, `given_write_tests_behavior_config()`, `given_behavior_main_instructions_created(bot_directory, behavior, description, goal)` |
| `given_behavior_config_dict(name, actions=None, **kwargs)` | `given_knowledge_behavior_config()`, `given_code_behavior_config()`, `given_write_tests_behavior_config()` |
| `given_behavior_instance(bot_directory, behavior, bot_name=None)` | `when_behavior_is_initialized(bot_name, behavior, bot_directory)` |
| `then_behaviors_orders_differ(behavior_instance1, behavior_instance2)` | `then_behaviors_have_different_orders(knowledge_behavior_instance, code_behavior_instance)` |
| `then_behavior_actions_order(behavior_instance, expected_order)` | `then_knowledge_behavior_has_standard_order(knowledge_behavior_instance)`, `then_code_behavior_has_reversed_order(code_behavior_instance)` |
| `given_behaviors_instances(bot_directory, behaviors, bot_name=None)` | `when_create_behavior_instances(bot_name, knowledge_behavior, code_behavior, bot_directory)` |
| `given_bot_paths(workspace_dir)` | `when_bot_paths_is_created(workspace_dir)` |
| `given_behavior_config_from_paths(bot_paths, behavior)` | `when_behavior_config_is_created(behavior, bot_paths)` |
| `then_behavior_config_matches(behavior_config, **kwargs)` | `then_behavior_config_matches_fields(behavior_config, expected_name, expected_description, ...)` |
| `then_actions_sorted(behavior_config, expected_actions, expected_names)` | `then_actions_workflow_sorted(behavior_config, expected_actions, expected_names)` |
| `then_behavior_states_and_transitions_match(behavior_instance)` | `then_workflow_states_and_transitions_match_tests(behavior_instance)` |
| `given_actions_workflow_dict(actions)` | `given_code_behavior_actions_workflow()` |
| `given_state_file(state_file)` | `given_behavior_action_state_file_loaded(state_file)` |
| `then_bot_has_method(bot, method)` | `then_bot_has_close_current_action_method(bot)`, `then_actions_has_close_current_method(actions)`, `then_actions_has_execute_current_method(actions)` |

## VALIDATE KNOWLEDGE & CONTENT AGAINST RULES Sub-Epic

| New Consolidated Function | Existing Functions (comma-delimited) |
|--------------------------|--------------------------------------|
| `then_violation_matches(violation, line_number=None, location=None, message=None, severity=None)` | `then_violation_has_expected_line_number(violation, expected_line_number)`, `then_violation_has_expected_location(violation, expected_location)`, `then_violation_has_expected_message(violation, expected_message)`, `then_violation_has_expected_severity(violation, expected_severity)` |
| `then_violations_match(violated_story_names, expected_stories=None, expected_violations=None, file=None, count=None, files=None, scanner=None, message=None)` | `then_violations_match_expected_scope_and_stories(violated_story_names, expected_stories_in_scope_set, expected_violations_set)`, `then_violations_detected_in_test_file(all_violations, test_file)`, `then_violations_detected_in_test_files_count(all_violations, expected_count)`, `then_violations_found_in_test_files(all_violations, test_files)`, `then_violations_detected_in_test_files_count(all_violations)`, `then_scanner_detects_violations_with_expected_message(violations, scanner_class_path, expected_violation_message)` |
| `given_action_initialized(action_type, bot_directory, bot_name='story_bot', behavior='exploration', workspace_directory=None, create_story_graph=True)` | `given_validate_action_initialized(bot_directory, bot_name, behavior, create_story_graph, workspace_directory)`, `given_validate_action_created(bot_directory, bot_name, behavior)`, `given_validate_action_for_test_bot(test_bot_dir, bot_name, behavior)`, `given_gather_context_action_is_initialized(bot_directory, bot_name, behavior_name)`, `given_strategy_action_is_initialized(bot_directory, bot_name, behavior_name)` |
| `when_action_tracks_start(action)` | `when_validate_action_tracks_start(action)`, `when_action_tracks_activity_on_start(action)` |
| `when_action_tracks_completion(action, outputs=None, duration=None)` | `when_validate_action_tracks_completion(action, outputs, duration)`, `when_action_tracks_activity_on_completion(action, outputs, duration)` |
| `when_action_finalizes(action, next_action=None)` | `when_action_finalizes_and_transitions(action, next_action)` |
| `when_action_injects(action, content='next_action')` | `when_action_injects_next_action_instructions(action)`, `when_action_injects_questions_and_evidence(action)`, `when_action_injects_strategy_criteria_and_assumptions(action)` |
| `then_activity_log_matches(workspace_directory, workflow_complete=None, count=None, action_states=None, last_action_state=None)` | `then_completion_entry_has_workflow_complete_flag(workspace_directory)`, `then_activity_log_has_entries_with_action_states(workspace_directory, expected_count, expected_action_states)`, `then_activity_log_has_entry_count_and_last_action_state(workspace_directory, expected_count, expected_last_action_state)`, `then_activity_log_contains_entries(log_file, expected_entries)`, `then_activity_log_has_two_entries_with_expected_states(workspace_directory)` |
| `then_scanners_match(behavior, count=None, structure_valid=None)` | `then_scanners_discovered_with_expected_count_and_valid_structure(behavior, expected_scanner_count)` |
| `then_instructions_match(instructions, structure=None, config_path=None, sources=None, behavior=None, action=None)` | `then_validation_rules_have_expected_structure(instructions)`, `then_config_path_matches_expected(instructions, expected_path)`, `then_instructions_merged_from_both_sources(merged_instructions, behavior, action)`, `then_base_instructions_only_present(merged_instructions, behavior, action)` |
| `then_action_instructions_match(action, knowledge_graph=None, test_files=None)` | `then_inject_validation_instructions_result_has_instructions(action, knowledge_graph, test_file_paths)` |
| `then_scanner_class_matches(scanner_class, error_msg=None)` | `then_scanner_class_loaded_successfully(scanner_class, error_msg)` |
| `when_scanner_created(scanner_class)` | `when_scanner_instance_created(scanner_class)` |
| `when_scanner_scans(scanner_instance, bad_example, rule_obj, scanner_type='auto')` | `when_test_scanner_scans_files(scanner_instance, bad_example, rule_obj)`, `when_code_scanner_scans_files(scanner_instance, bad_example, rule_obj)`, `when_story_scanner_scans_knowledge_graph(scanner_instance, bad_example, rule_obj)`, `when_execute_scanner_based_on_type(scanner_instance, bad_example, rule_obj)` |
| `when_story_graph_updated(story_graph_path, story_graph, scope=None)` | `when_add_scope_to_story_graph_file(story_graph_path, story_graph, scope_config)`, `when_add_scope_to_story_graph_if_provided(story_graph_path, story_graph, scope_config)` |
| `when_stories_extracted(story_graph, extract_method, as_set=False)` | `when_convert_expected_stories_to_set(expected_stories_in_scope, story_graph, extract_method)` |
| `when_violations_extracted(story_graph, extract_method, as_set=False)` | `when_convert_expected_violations_to_set(expected_violations_list, expected_stories_in_scope_set, story_graph, extract_method)` |
| `when_parameters_created(scope=None, test_files=None, code_files=None)` | `when_create_parameters_from_scope_config(scope_config)`, `when_create_test_file_parameter(test_file)`, `when_create_test_files_parameter(test_files)`, `when_create_code_files_parameter(code_files)`, `when_create_empty_parameters()` |
| `when_action_executes_and_extracts(action, parameters, extract='violations')` | `when_execute_action_and_extract_violations(action, parameters)`, `when_execute_action_and_extract_violated_story_names_with_conversion(action, parameters, story_graph, test_case, extract_story_names_method, convert_stories_method, convert_violations_method, extract_epic_method)` |
| `when_action_executes(action_type, bot_directory, behavior, parameters=None, expect_error=None)` | `when_execute_validate_code_files_action_with_test_files(bot_name, behavior, bot_directory, test_files)`, `when_execute_validate_code_files_action_with_single_test_file(bot_name, behavior, bot_directory, test_file)`, `when_execute_validate_code_files_action_with_code_files(bot_name, behavior, bot_directory, code_files)`, `when_action_executes_and_returns_result(action, parameters)`, `when_action_executes_and_raises_file_not_found_error(action)`, `when_action_executes_and_raises_json_error(action)`, `when_action_executes_with_clarification_parameters(action, parameters)`, `when_action_executes_with_parameters(action, parameters)` |
| `when_action_executes_and_verifies(action, test_file, story_graph_path)` | `when_execute_test_file_scope_validation(action, test_file, story_graph_path)`, `when_execute_test_file_scope_verification(action, test_file, story_graph)`, `when_execute_multiple_test_files_scope_validation(action, test_file1, test_file2, story_graph_path)` |
| `then_file_unchanged(file_path)` | `then_story_graph_not_modified_with_test_files(story_graph_path)` |
| `given_directory_created(directory)` | `given_workspace_directory_created(workspace_directory)`, `given_docs_stories_directory_exists(workspace_directory)`, `given_knowledge_graph_directory_created(bot_directory, behavior)`, `given_docs_directory_created(bot_directory)`, `given_knowledge_graph_directory_for_prioritization(bot_directory, behavior)`, `given_behavior_render_directory_created(bot_directory, behavior)` |
| `given_rule_file_created(bot_directory, behavior, rule_filename, rule_content=None)` | `given_behavior_rule_file_created(bot_directory, behavior, rule_filename, rule_content)`, `given_scenarios_rule_created(bot_directory, behavior_name)`, `given_test_scope_verification_rule_created(bot_directory)`, `given_validation_rule_for_verb_noun_format(bot_directory)`, `given_validation_rules_created(bot_directory, rule_name, rule_content)` |
| `given_rule_content_dict(rule_type=None)` | `given_verb_noun_rule_content()` |
| `given_validation_setup(bot_directory, workspace_directory, behavior, violations=False, rule_type=None, rules=False, rule_id=None, scope_type=None, story_graph=None)` | `given_story_graph_and_test_file_with_violations_setup(bot_directory, workspace_directory, behavior)`, `given_test_file_and_naming_rule_setup(bot_directory, workspace_directory, behavior)`, `given_story_graph_test_file_and_rules_setup(bot_directory, workspace_directory, behavior)`, `given_test_file_and_naming_rule_with_rule_id_setup(bot_directory, workspace_directory, behavior)`, `given_comprehensive_story_graph_setup_for_scope_test(bot_directory, workspace_directory, create_method)`, `given_test_file_scope_verification_setup(bot_directory, workspace_directory)`, `given_test_file_scope_setup_with_rule(bot_directory, workspace_directory)`, `given_multiple_test_files_scope_setup_with_rule(bot_directory, workspace_directory)` |
| `given_scanner_test_setup(bot_directory, workspace_directory, scanner_class_path, behavior)` | `when_setup_scanner_test_environment(bot_directory, workspace_directory, scanner_class_path, behavior)` |
| `given_file_created_if_needed(directory, scanner_class_path, behavior, bad_example)` | `when_create_test_file_if_needed_for_scanner(workspace_directory, scanner_class_path, behavior, bad_example)` |
| `given_action_setup(action_type, bot_directory, workspace_directory, rules=False, report_path=False, existing_data=False, parameters=None)` | `given_base_action_instructions_and_behavior_rule_setup(bot_directory, workspace_directory)`, `given_environment_and_action_for_report_path_test(bot_directory, workspace_directory)`, `given_environment_action_and_parameters_for_clarification(bot_directory, workspace_directory)`, `given_environment_with_existing_clarification_and_action(bot_directory, workspace_directory)`, `given_environment_action_and_empty_parameters(bot_directory, workspace_directory)`, `given_environment_action_and_strategy_parameters(bot_directory, workspace_directory)`, `given_environment_with_existing_strategy_and_action(bot_directory, workspace_directory)`, `given_environment_action_and_empty_strategy_parameters(bot_directory, workspace_directory)` |
| `given_bot_setup(bot_directory, workspace_directory, rules=None, knowledge_graph=None)` | `given_test_bot_setup_with_rules(repo_root, bot_directory, workspace_directory, rule_file_paths, rule_file_content)`, `given_knowledge_graph_and_test_bot_setup(repo_root, bot_directory, workspace_directory, knowledge_graph, rule_file_path, rule_file_content)` |
| `given_activity_log(workspace_directory, entries)` | `given_activity_log_with_entries(workspace_directory, entries)`, `given_activity_log_contains_entries(workspace_directory, entries)`, `given_activity_log_with_multiple_entries(workspace_directory)` |
| `when_workflow_completion_checked(behavior, state_file)` | `when_check_workflow_completion_status(behavior, state_file)` |
| `then_workflow_completion_matches(is_complete, expected=True)` | `then_behavior_workflow_is_complete(is_complete)` |
| `then_stories_match(expected, stories_to_check, present=None, equal=None)` | `then_expected_story_names_contain_stories(expected, stories_to_check, should_be_present)`, `then_expected_story_names_equal(expected, expected_stories)` |
| `given_story_graph_dict(minimal=False, scope_type=None, epic=None)` | `given_minimal_story_graph_for_test_file_scope()`, `given_story_graph_for_multiple_test_files()`, `given_test_story_graph()`, `given_existing_story_graph_with_mob_epic()` |
| `when_story_graph_copied(story_graph)` | `when_copy_story_graph_for_test(story_graph)` |
| `when_scope_extracted(story_graph, method, get_expected=None)` | `when_test_scope_extraction_with_increment_priorities(story_graph, get_expected_method)`, `when_test_scope_extraction_with_epic_names(story_graph, get_expected_method)`, `when_test_scope_extraction_with_multiple_epics(story_graph, get_expected_method)`, `when_test_scope_extraction_with_story_names(story_graph, get_expected_method)` |
| `given_file_paths(files)` | `given_test_file_paths_for_knowledge_graph(test_file)` |
| `given_rule_object(rule_filename, scanner_class_path, behavior_name)` | `given_rule_object_for_scanner(rule_filename, scanner_class_path, behavior_name)` |
| `given_scanner_spy(scanner_type='test', record=None)` | `given_spy_test_scanner_that_records_knowledge_graph()` |
| `when_test_case_extracted(test_case)` | `when_extract_test_case_data(test_case)` |

## BUILD KNOWLEDGE Sub-Epic

| New Consolidated Function | Existing Functions (comma-delimited) |
|--------------------------|--------------------------------------|
| `given_knowledge_graph_setup(bot_directory, behavior, template_name='default')` | `given_knowledge_graph_setup_complete(bot_directory, behavior, template_name)`, `given_knowledge_graph_config_and_template_created(kg_dir)`, `given_knowledge_graph_directory_structure_created(bot_directory, behavior)`, `given_knowledge_graph_directory_for_prioritization(bot_directory, behavior)`, `given_environment_and_knowledge_graph_setup(bot_directory, workspace_directory, behavior)` |
| `when_action_executes(action_type, bot_directory, behavior, merge_instructions=False, inject_all=False, template_type='default')` | `when_build_action_injects_template(bot_name, behavior, bot_directory)`, `when_build_action_loads_and_merges_instructions(bot_name, behavior, bot_directory)`, `when_build_action_loads_and_injects_all_instructions(action_obj)`, `when_build_action_injects_template_for_increments(bot_name, behavior, bot_directory)` |
| `then_template_variables_replaced(instructions_text, type=None)` | `then_all_template_variables_replaced(base_instructions_text)`, `then_render_configs_template_variable_replaced(base_instructions_text)`, `then_render_instructions_template_variable_replaced(base_instructions_text)` |
| `when_story_map_created(bot)` | `when_story_map_created_from_bot(bot)`, `when_story_map_created_from_mock_bot(test_instance, bot_directory)` |
| `then_story_map_matches(story_map, epic=None)` | `then_story_map_contains_test_epic(story_map)`, `then_epics_contain_single_build_epic(epics)`, `then_epics_match(epics, count=1, name='build')` |
| `when_epic_retrieved(epics, index=None, type=None)` | `when_first_epic_retrieved(epics)`, `when_sub_epic_retrieved_from_epics(epics)`, `when_story_retrieved_from_epics(epics)`, `when_scenario_retrieved_from_epics(epics)`, `when_scenario_outline_retrieved_from_epics(epics)`, `when_story_map_epics_retrieved(story_map)` |
| `when_epic_children_retrieved(epic)` | `when_sub_epic_and_story_group_retrieved(epic)`, `when_epic_children_retrieved(epic)`, `when_sub_epic_children_retrieved(sub_epic)`, `when_story_group_stories_retrieved(story_group)` |
| `then_location_matches(item, type=None)` | `then_epic_map_location_correct(epic)`, `then_sub_epic_map_location_correct(sub_epic)`, `then_story_map_location_correct(story)`, `then_scenario_map_location_correct(scenario)`, `then_scenario_outline_map_location_correct(scenario_outline)` |
| `then_nodes_match(nodes, structure='expected')` | `then_nodes_match_expected_structure(nodes)` |
| `when_story_map_walked(story_map, epic)` | `when_story_map_walked(story_map, epic)` |
| `then_children_match(children, count=None, type=None, name=None)` | `then_children_contain_single_sub_epic(children, expected_name)`, `then_children_contain_single_story_group(children)`, `then_stories_contain_single_story(stories, expected_name)` |
| `then_stories_match(stories, count=None, name=None)` | `then_stories_contain_single_story(stories, expected_name)` |
| `when_story_retrieved(story_map, by='path')` | `when_story_retrieved_from_path(story_map)` |
| `then_story_matches(story, properties='expected')` | `then_story_has_expected_properties(story)` |
| `when_story_retrieved(story, type='scenarios')` | `when_story_scenarios_retrieved(story)`, `when_story_scenario_outlines_retrieved(story)` |
| `then_scenarios_match(scenarios, expected=True)` | `then_scenarios_contain_expected_scenarios(scenarios)` |
| `when_scenario_retrieved(story)` | `when_scenario_retrieved_from_story(story)` |
| `then_scenario_matches(scenario, properties='expected')` | `then_scenario_has_expected_properties(scenario)` |
| `then_scenario_outlines_match(scenario_outlines, expected=True)` | `then_scenario_outlines_contain_expected_outline(scenario_outlines)` |
| `when_scenario_outline_retrieved(story)` | `when_scenario_outline_retrieved_from_story(story)` |
| `then_scenario_outline_matches(scenario_outline, examples='expected')` | `then_scenario_outline_has_expected_examples(scenario_outline)` |
| `given_template_variables(behavior=None, action=None)` | `given_test_variables_for_exploration()`, `given_test_variables_for_shape_build()`, `given_test_variables_for_prioritization()`, `given_template_variables_test_setup(bot_directory, workspace_directory)` |
| `then_file_updated(file_path, updates=None)` | `then_story_graph_updated_with_increments(instructions, story_graph_path)` |
| `then_instructions_match(instructions, update_existing=None, output=None)` | `then_instructions_indicate_updating_existing_file(instructions, expected_output)` |
| `given_action_outputs(action='build')` | `given_build_outputs()`, `given_action_outputs_with_counts(questions_count, evidence_count)`, `given_action_outputs_and_duration()` |
| `given_action_duration(action='build')` | `given_build_duration()`, `given_action_duration(duration)` |
| `given_action_config_copied(bot_directory, action_name)` | `given_base_instructions_copied_to_bot_directory(bot_directory, action_name)`, `given_base_instructions_for_render_output_copied(bot_directory)` |
| `given_behavior_instructions(bot_directory, behavior, action, kg_dir=None)` | `given_behavior_specific_instructions_created(bot_directory, behavior, action, kg_dir)`, `given_behavior_render_instructions_created(bot_directory, behavior)` |
| `given_action_setup(bot_directory, workspace_directory, behavior, action, bot_name=None, base_only=False)` | `given_base_and_behavior_instructions_setup(bot_directory, workspace_directory, bot_name, behavior, action)`, `given_base_instructions_only_setup(bot_directory, workspace_directory, bot_dir, behavior, action)` |
| `when_instructions_extracted(instructions, type='text')` | `given_base_instructions_text_extracted(instructions)` |

## GATHER CONTEXT Sub-Epic

| New Consolidated Function | Existing Functions (comma-delimited) |
|--------------------------|--------------------------------------|
| `given_action_outputs(action='gather_context', questions_count=None, evidence_count=None)` | `given_action_outputs_with_counts(questions_count, evidence_count)`, `given_action_outputs_and_duration()` |
| `given_action_duration(action='gather_context', duration=None)` | `given_action_duration(duration)` |
| `given_activity_log_entries(bot_name, behaviors, expected=False)` | `given_activity_log_entries_for_behaviors(bot_name, behaviors)`, `given_expected_activity_log_entries_for_behaviors(bot_name, behaviors)` |
| `given_guardrails_data(type=None, behavior=None)` | `given_questions_and_evidence_for_guardrails()`, `given_expected_key_questions_for_shape()`, `given_expected_evidence_for_shape()`, `given_discovery_key_questions_and_evidence()`, `given_clarification_parameters_with_questions_and_evidence()`, `given_clarification_parameters_for_shape_behavior()`, `given_discovery_strategy_decisions_and_assumptions()`, `given_expected_strategy_decisions_and_assumptions()`, `given_strategy_assumptions_and_criteria()`, `given_strategy_parameters_with_decisions_and_assumptions()`, `given_strategy_parameters_for_shape_behavior()` |
| `then_data_matches(data, scope=None, user_types=None, drill_down=None, behavior=None)` | `then_clarification_data_contains_discovery_scope(clarification_data, expected_scope)`, `then_clarification_data_contains_shape_user_types(clarification_data, expected_user_types)`, `then_strategy_data_contains_discovery_scope(strategy_data, expected_scope)`, `then_strategy_data_contains_shape_drill_down(strategy_data, expected_drill_down)` |
| `then_file_exists(file_path, bot_paths=None)` | `then_clarification_json_file_exists(workspace_directory, bot_paths)`, `then_strategy_json_file_exists(workspace_directory, bot_paths)`, `then_activity_log_file_exists(log_file)` |
| `then_file_does_not_exist(file_path, bot_paths=None)` | `then_clarification_json_file_does_not_exist(workspace_directory, bot_paths)`, `then_strategy_json_file_does_not_exist(workspace_directory, bot_paths)`, `then_activity_log_file_does_not_exist(workspace_directory)` |
| `then_file_matches(file_path, behavior=None, key_questions=None, evidence=None, decisions=None, assumptions=None, behaviors=None, preserve=False)` | `then_clarification_json_contains_behavior_data(clarification_file, behavior, expected_key_questions, expected_evidence)`, `then_clarification_json_preserves_existing_behaviors(clarification_file, existing_behaviors)`, `then_strategy_json_contains_behavior_data(strategy_file, behavior, expected_decisions, expected_assumptions)`, `then_strategy_json_preserves_existing_behaviors(strategy_file, existing_behaviors)` |
| `given_file_created(directory, filename, content, file_type='json', bot_paths=None)` | `given_clarification_json_exists_with_data(workspace_directory, behavior, key_questions, evidence, bot_paths)`, `given_strategy_json_exists_with_data(workspace_directory, behavior, decisions_made, assumptions_made, bot_paths)` |
| `then_action_matches(action, is_none=None, properties_accessible=None, instructions_is_none=None, order_type=None, tracker_is_none=None, bot_name=None, behavior=None, has_property=None, order=None, next_action=None)` | `then_action_is_not_none(action)`, `then_action_is_none(action)`, `then_action_properties_accessible(action)`, `then_action_instructions_is_not_none(action)`, `then_action_order_is_integer(action)`, `then_action_tracker_is_not_none(action)`, `then_action_has_correct_bot_name_and_behavior(action, expected_bot_name, expected_behavior)`, `then_base_action_config_order_is(base_action_config, expected_order)`, `then_base_action_config_next_action_is(base_action_config, expected_next_action)` |
| `then_actions_matches(actions, count=None)` | `then_actions_collection_contains_actions(actions, expected_count)` |
| `then_guardrails_matches(guardrails, required_context_is_none=None, strategy_is_none=None, properties_accessible=None)` | `then_guardrails_properties_accessible(guardrails)`, `then_guardrails_required_context_is_not_none(guardrails)`, `then_guardrails_strategy_is_not_none(guardrails)`, `then_guardrails_required_context_is_not_none_from_value(required_context)`, `then_guardrails_strategy_is_not_none_from_value(strategy)` |
| `when_action_found(actions, by='name', value=None)` | `when_actions_find_by_name(actions, action_name)`, `when_actions_find_by_order(actions, order)` |
| `when_actions_navigate(actions, action_name)` | `when_actions_navigates_to(actions, action_name)` |
| `when_current_action_accessed(actions)` | `when_actions_current_accessed(actions)` |
| `when_next_action_accessed(actions)` | `when_actions_next_accessed(actions)` |
| `then_next_action_matches(next_action, may_be_none=None)` | `then_next_action_may_be_none_or_not_none(next_action)` |
| `then_current_action_matches(actions, is_none=None, name=None)` | `then_current_action_is_not_none(actions)`, `then_current_action_name_is(actions, expected_name)` |
| `then_actions_has_method(actions, method)` | `then_actions_has_close_current_method(actions)`, `then_actions_has_execute_current_method(actions)` |
| `given_guardrails_setup(bot_directory, behavior_name, bot_name=None, type=None, assumptions=None, criteria=None)` | `given_guardrails_files_created(bot_directory, behavior_name, bot_name)`, `given_strategy_guardrails_exist(bot_directory, behavior, assumptions, criteria)`, `given_environment_bootstrapped_with_guardrails(bot_directory, workspace_directory)`, `given_environment_bootstrapped_with_malformed_guardrails(bot_directory, workspace_directory)`, `given_environment_bootstrapped_with_strategy_guardrails(bot_directory, workspace_directory)` |
| `when_guardrails_accessed(guardrails, type=None)` | `when_guardrails_required_context_accessed(guardrails)`, `when_guardrails_strategy_accessed(guardrails)` |
| `when_action_config_created(action_name, bot_paths)` | `when_base_action_config_instantiated(action_name, bot_paths)` |
| `when_actions_created(behavior_config, behavior)` | `when_actions_instantiated(behavior_config, behavior)` |
| `when_action_created(base_action_config, behavior)` | `when_action_instantiated(base_action_config, behavior)` |
| `when_guardrails_created(behavior)` | `when_guardrails_instantiated(behavior)` |
| `then_action_config_matches(base_action_config, properties_accessible=None, order=None, next_action=None)` | `then_base_action_config_properties_accessible(base_action_config)`, `then_base_action_config_order_is(base_action_config, expected_order)`, `then_base_action_config_next_action_is(base_action_config, expected_next_action)` |
| `when_behavior_config_accessed(behavior)` | `when_behavior_config_accessed_from_behavior(behavior)` |
| `when_actions_counted(behavior_config)` | `when_actions_count_from_behavior_config(behavior_config)` |

## RENDER OUTPUT Sub-Epic

| New Consolidated Function | Existing Functions (comma-delimited) |
|--------------------------|--------------------------------------|
| `given_render_setup(bot_directory, behavior)` | `given_render_dir_and_configs_setup(bot_directory, behavior)` |
| `when_render_configs_formatted(action_obj)` | `when_format_render_configs(action_obj)` |
| `then_formatted_configs_match(formatted, contains=None, fields=None)` | `then_formatted_configs_contain_sync_and_template(formatted)`, `then_formatted_configs_contain_synchronizer_fields(formatted)`, `then_formatted_configs_contain_template_fields(formatted)` |
| `given_render_configs(render_dir, types=None)` | `when_create_sync_and_template_configs(render_dir)`, `given_render_configs_created(render_dir, configs)` |
| `given_bot_and_behavior(bot_name=None, behavior=None)` | `given_bot_name_and_behavior_for_discovery()`, `given_bot_name_and_behavior_for_shape()` |
| `when_action_created(action_type, bot_directory, bot_name, behavior)` | `when_create_render_output_action(bot_name, behavior, bot_directory)`, `when_render_output_action_created(bot_name, behavior, bot_directory)` |
| `when_instructions_merged(base_action_config, render_instructions=None)` | `when_merged_instructions_instantiated(base_action_config, render_instructions)`, `when_instructions_instantiated(base_action_config, behavior)` |
| `when_instructions_accessed(merged_instructions, type=None)` | `when_render_instructions_accessed(merged_instructions)`, `when_base_instructions_accessed(instructions)`, `when_behavior_instructions_accessed(instructions)` |
| `when_instructions_merge_called(merged_instructions)` | `when_merge_called(merged_instructions)` |
| `then_instructions_match(result, expected=None, is_none=None, contains=None, present=None, type=None)` | `then_render_instructions_are(result, expected)`, `then_render_instructions_is_none(result)`, `then_merged_contains_base_instructions(merged, expected)`, `then_merged_contains_render_instructions(merged, expected)`, `then_merged_does_not_contain_render_instructions(merged)`, `then_render_instructions_matches_expected(result, expected_result)`, `then_base_instructions_are(result, expected)`, `then_behavior_instructions_are(result, expected)`, `then_merged_contains_behavior_instructions(merged, expected)`, `then_merged_instructions_list_contains_all(merged, base, behavior)`, `then_merged_instructions_list_equals(merged, expected)` |

## DECIDE STRATEGY CRITERIA ACTION Sub-Epic

| New Consolidated Function | Existing Functions (comma-delimited) |
|--------------------------|--------------------------------------|
| `given_action_setup(action_type, bot_directory, workspace_directory, rules=False, report_path=False, existing_data=False, parameters=None)` | `given_environment_bootstrapped_and_strategy_action_initialized(bot_directory, workspace_directory)`, `given_environment_action_and_strategy_parameters(bot_directory, workspace_directory)`, `given_environment_with_existing_strategy_and_action(bot_directory, workspace_directory)`, `given_environment_action_and_empty_strategy_parameters(bot_directory, workspace_directory)` |

## GENERATE MCP TOOLS Sub-Epic

| New Consolidated Function | Existing Functions (comma-delimited) |
|--------------------------|--------------------------------------|
| `given_behaviors_list(behaviors=None)` | `given_test_bot_behaviors()` |
| `given_trigger_patterns(behavior=None, catalog_test=False)` | `given_trigger_patterns_for_shape_behavior()`, `given_trigger_patterns_for_catalog_test()` |
| `given_bot_config(bot_directory, bot_name, behaviors=None, working_dir=None, goal=None, description=None, valid=True, exists=True, content=None)` | `given_bot_config_file_with_working_dir_and_behaviors(...)`, `given_bot_config_file_with_invalid_json(workspace_root, bot_name, invalid_content)`, `given_bot_config_does_not_exist(workspace_root, bot_name)`, `given_bot_config_has_goal_and_description(workspace_root, bot_name, goal, description)`, `given_bot_config_for_single_behavior(workspace_root, bot_name, behavior)`, `given_bot_config_and_dir_for_single_behavior(workspace_root, bot_name, behavior)` |
| `given_base_actions_setup(bot_dir)` | `given_base_actions_structure_exists(bot_dir)` |
| `given_behaviors_config(bot_dir, behaviors, descriptions=False, trigger_words=False)` | `given_behavior_workflow_files_exist_for_behaviors(bot_dir, behaviors)`, `given_behaviors_with_descriptions_and_trigger_words(bot_dir, behaviors_config)`, `given_behavior_without_trigger_words(bot_dir, behavior)` |
| `given_bot_config_dict(goal=False, behaviors_descriptions=False)` | `given_bot_goal_and_behavior_descriptions()` |
| `given_behaviors_config_dict(descriptions=False, patterns=False)` | `given_behaviors_config_with_descriptions_and_patterns()` |
| `given_bot_and_action(behavior=None, action=None)` | `given_test_bot_behavior_and_action()` |
| `given_bot_name(name=None)` | `given_test_bot_name()` |
| `given_bot_directory(workspace_root, bot_name)` | `given_bot_directory_path(workspace_root, bot_name)` |
| `when_tool_generator_executes(generator_type, bot_name, config_path, behaviors=None)` | `when_bot_tool_generator_processes_config(bot_name, config_path)`, `when_behavior_tool_generator_processes_config(bot_name, config_path)`, `when_mcp_server_generator_receives_bot_config(bot_dir, behaviors)` |
| `when_awareness_files_generated(bot_dir)` | `when_generator_generates_awareness_files(bot_dir)`, `when_generator_generates_awareness_files_direct(generator)` |
| `when_server_deployed(config_path, workspace_root, protocol_handler_url=None)` | `when_server_deployer_deploys(config_path, workspace_root, protocol_handler_url)` |
| `when_catalog_retrieved(config_path, workspace_root)` | `when_server_deployer_gets_catalog(config_path, workspace_root)` |
| `when_tool_found(generator, behavior=None)` | `when_find_behavior_tool_in_registered_tools(generator, behavior)` |
| `when_awareness_file_read(rules_file)` | `when_read_awareness_file_content(rules_file)` |
| `when_awareness_files_generated_and_read(bot_dir, bot_name)` | `when_generate_awareness_files_and_read_content(bot_dir, bot_name)` |
| `when_deployment_attempted(config_file, workspace_root, invalid_url=False)` | `when_deployer_attempts_deployment_with_invalid_url(config_file, workspace_root)` |
| `when_rules_directory_created()` | `when_create_rules_directory_if_needed()` |
| `then_tool_generator_creates_tools(generator, tool_type=None, expected_count=None, expected_behaviors=None)` | `then_generator_creates_behavior_tools_with_names(generator, expected_count, expected_behaviors)`, `then_bot_tool_instance_created(bot_tool, expected_count)`, `then_generator_creates_sufficient_tools(generator, min_tool_count)`, `then_generator_creates_bot_tools(generator)` |
| `then_tool_registered(generator, behavior=None, patterns=None)` | `then_behavior_tool_registered_with_patterns(generator, behavior, patterns)`, `then_behavior_tool_registered_without_patterns(generator, behavior)` |
| `then_server_created(artifacts, bot_name)` | `then_mcp_server_instance_created(artifacts, bot_name)` |
| `then_server_code_matches(artifacts, bot_name=None)` | `then_server_code_includes_bot_instantiation(artifacts, bot_name)` |
| `then_generator_raises_error(generator, error_type, bot_dir=None, config_path=None)` | `then_generator_raises_file_not_found_error(bot_dir, expected_config_path)`, `then_generator_raises_json_decode_error(bot_dir, config_file)` |
| `then_tool_execution_succeeds(result, expected_behavior=None, expected_action=None)` | `then_behavior_tool_execution_succeeds(result, expected_behavior, expected_action)` |
| `then_deployment_matches(deployment_result, success=None, expected_server_name=None, min_tool_count=None, expected_error_substring=None)` | `then_deployment_succeeds(deployment_result, expected_server_name, min_tool_count)`, `then_deployment_fails_with_error(deployment_result, expected_error_substring)` |
| `then_awareness_file_matches(rules_file, bot_name=None, behavior_names=None, tool_patterns=None, behavior_section=None, trigger_words=None, sections=None, bot_name_present=None, priority_check=None, repair_question=None)` | `then_awareness_file_created_with_bot_specific_filename(bot_name)`, `then_awareness_file_contains_behavior_sections(content, behavior_names)`, `then_awareness_file_contains_tool_patterns(content, bot_name, behavior_names)`, `then_trigger_words_in_behavior_section(content, behavior_name, trigger_words)`, `then_awareness_file_shape_section_contains_only_shape_words(content)`, `then_awareness_file_contains_tool_patterns_for_behaviors(content, bot_name, behaviors)`, `then_awareness_file_contains_behavior_format_sections(content, bot_name)`, `then_awareness_file_contains_error_handling_section(content)`, `then_awareness_file_contains_required_sections(rules_file, bot_name)`, `then_awareness_file_contains_bot_name(content, bot_name)`, `then_awareness_file_contains_priority_check_message(content, bot_name)`, `then_awareness_file_contains_repair_question(content)` |
| `then_directory_exists(directory, is_directory=None)` | `then_rules_directory_exists_and_is_directory()`, `then_rules_directory_and_file_exist()` |
| `then_awareness_file_exists(rules_dir, bot_name)` | `then_awareness_file_exists_with_bot_specific_filename(rules_dir, bot_name)` |
| `then_catalog_matches(catalog, behavior=None, patterns=None, tools_registered=None)` | `then_catalog_has_tools_for_behavior(catalog, behavior, patterns)`, `then_catalog_has_tools_registered(catalog)` |
| `then_permission_error_raised(function, expected_filename)` | `then_permission_error_raised_with_bot_specific_path(function, expected_filename)` |
| `given_bot_directory_without_base_actions(tmp_path, bot_name)` | `given_bot_directory_created_without_base_actions(tmp_path, bot_name)` |
| `given_fake_repo_root(tmp_path)` | `given_fake_repo_root_created(tmp_path)` |
| `given_pycache_directories(base_path, cache_paths)` | `given_test_pycache_directories_list(tmp_path)`, `given_pycache_directories_exist(base_path, cache_paths)` |
| `when_cache_cleared(base_path)` | `when_clear_python_cache_is_called(base_path)` |
| `then_cache_cleared_matches(cache_dirs, removed=None, pyc_deleted=None, count=None)` | `then_all_pycache_directories_removed(cache_dirs)`, `then_all_pyc_files_deleted(cache_dirs)`, `then_cache_cleared_count_matches(cached_count, expected_count)` |
| `when_processes_found(server_name)` | `when_find_mcp_server_processes_is_called(server_name)` |
| `then_processes_valid(processes)` | `then_processes_list_is_valid(processes)` |
| `when_generator_created_without_base_actions(bot_directory, fake_repo_root)` | `when_mcp_generator_created_without_base_actions(bot_directory, fake_repo_root)` |

## INVOKE CLI Sub-Epic

| New Consolidated Function | Existing Functions (comma-delimited) |
|--------------------------|--------------------------------------|
| `when_trigger_executed(setup, helper, trigger_message, current_behavior=None, current_action=None)` | `when_execute_trigger_for_all_behaviors_and_actions(setup, helper, trigger_message, current_behavior, current_action)` |
| `then_route_and_result_match(setup, helper, behavior, action, route, result, trigger_message, match_type=None)` | `then_verify_route_and_result_for_bot_only(setup, helper, behavior, action, route, result, trigger_message)`, `then_verify_route_and_result_for_bot_and_behavior(setup, helper, behavior, action, route, result, trigger_message)`, `then_verify_route_and_result_for_explicit_action(setup, helper, behavior, action, route, result)`, `then_verify_close_trigger_route_and_result(setup, route, result)` |
| `when_action_triggers_setup(setup, action_trigger_templates)` | `when_setup_action_triggers_for_all_behaviors(setup, action_trigger_templates)` |
| `given_trigger_helper_and_message(setup, trigger_message)` | `given_trigger_router_helper_and_message(setup, trigger_message)` |
| `when_all_combinations_tested(setup, helper, trigger_message, verify_func, current_behavior=None, current_action=None)` | `when_test_all_behavior_action_combinations(setup, helper, trigger_message, verify_func, current_behavior, current_action)` |
| `given_behavior_triggers_dict()` | `given_standard_behavior_triggers_dict()`, `given_behavior_triggers_dictionary()` |
| `given_bot_setup_with_triggers(bot_directory, workspace_directory, triggers, trigger_type='behavior')` | `given_bot_setup_with_behavior_triggers(bot_directory, workspace_directory, behavior_triggers)`, `given_bot_setup_with_action_triggers(bot_directory, workspace_directory, action_trigger_templates)` |
| `given_action_triggers_dict()` | `given_action_trigger_templates_dict()`, `given_action_trigger_templates_dictionary()` |
| `when_cli_created(mock_bot)` | `when_cli_created_with_mock_bot(mock_bot)` |
| `when_all_behaviors_tested(setup, helper, triggers, verify_func)` | `when_test_all_behaviors_with_triggers(setup, helper, behavior_triggers, verify_func)`, `when_test_all_behaviors_with_action_templates(setup, helper, action_trigger_templates, verify_func)` |
| `given_mock_bot(tmp_path, bot_name)` | `given_mock_bot_created(tmp_path, bot_name)` |
| `when_cli_parameter_inferred(cli)` | `when_cli_infers_parameter_description_for_unknown_command(cli)` |
| `given_behavior_config_with_triggers(patterns, priority=None, list_format=False, no_triggers=False)` | `given_behavior_config_with_trigger_patterns(patterns, priority)`, `given_behavior_config_with_list_triggers(patterns)`, `given_behavior_config_with_no_triggers()` |
| `when_trigger_words_created(behavior_config, behavior=None)` | `when_trigger_words_instantiated(behavior_config, behavior)` |
| `when_trigger_matches(trigger_words, text)` | `when_matches_called(trigger_words, text)` |
| `when_priority_accessed(trigger_words)` | `when_priority_accessed(trigger_words)` |
| `then_priority_matches(result, expected)` | `then_priority_is(result, expected)` |
| `then_matches_result(result, expected)` | `then_matches_returns(result, expected)` |
| `given_behavior_config_from_triggers(trigger_config)` | `given_behavior_config_from_trigger_config(trigger_config)` |

## INVOKE MCP Sub-Epic

| New Consolidated Function | Existing Functions (comma-delimited) |
|--------------------------|--------------------------------------|
| `given_base_actions_setup(bot_directory)` | `given_base_actions_structure_created(bot_directory)` |
| `given_behavior_instructions_for_behaviors(workspace_root, bot_name, behaviors, action)` | `given_behavior_action_instructions_for_multiple_behaviors(workspace_root, bot_name, behaviors, action)` |
| `given_behavior_configs_for_behaviors(bot_directory, behaviors, bot_name)` | `given_behavior_json_files_for_behaviors(bot_directory, behaviors, bot_name)` |
| `given_base_action_instructions(bot_directory, action)` | `given_base_action_instructions_created(bot_directory, action)` |
| `then_bot_result_matches(result, status=None, behavior=None, action=None)` | `then_bot_result_has_status_and_behavior_and_action(result, expected_status, expected_behavior, expected_action)`, `then_bot_result_has_behavior_and_action(result, expected_behavior, expected_action)` |
| `given_knowledge_graph_for_behaviors(workspace_root, bot_name, behavior_mapping, action)` | `given_knowledge_graph_setup_for_behaviors(workspace_root, bot_name, behavior_mapping, action)` |
| `given_behavior_action_state(workspace_directory, current_behavior, current_action)` | `given_behavior_action_state_created(workspace_directory, current_behavior, current_action)` |
| `given_base_instructions(bot_directory)` | `given_base_instructions_created(bot_directory)` |
| `given_bot_config_and_workflow(bot_directory, bot_name, behaviors)` | `given_bot_config_and_behavior_workflow(bot_directory, bot_name, behaviors)` |
| `then_state_file_exists(workspace_directory)` | `then_behavior_action_state_file_exists(workspace_directory)` |
| `then_state_file_matches(state_file, expected_behavior=None, expected_action=None)` | `then_behavior_action_state_has_correct_values(state_file, expected_behavior, expected_action)` |
| `given_activity_tracker(workspace_directory, bot_name)` | `given_activity_tracker_created(workspace_directory, bot_name)` |
| `when_activity_tracks_start(tracker, bot_name, behavior, action)` | `when_activity_tracker_tracks_start(tracker, bot_name, behavior, action)` |
| `then_activity_log_at_path(expected_path, exists=None)` | `then_activity_log_exists_at_path(expected_path)`, `then_activity_log_does_not_exist_at_path(unexpected_path)` |
| `then_activity_log_matches(workspace_directory, action_state=None, status=None, single_entry=None)` | `then_activity_log_has_entry_with_action_state(workspace_directory, expected_action_state, expected_status)`, `then_activity_log_has_single_entry(workspace_directory, expected_action_state, expected_status)` |
| `given_bot_behavior_action(bot_name=None, behavior=None, action=None)` | `given_bot_name_behavior_and_action_setup()` |
| `when_action_created(action_type, bot_name, behavior, bot_directory)` | `when_create_gather_context_action(bot_name, behavior, bot_directory)`, `when_render_output_action_initialized(bot_directory, bot_name, behavior)` |
| `when_instructions_load_and_merge(action_obj)` | `when_load_and_merge_instructions(action_obj)` |
| `then_merged_instructions_contain(merged_instructions, base=None, action=None)` | `then_merged_instructions_contain_base_and_action(merged_instructions, action)` |
| `given_bot_and_behavior(bot_name, behavior)` | `given_bot_name_and_behavior_setup(bot_name, behavior)` |
| `given_render_instructions(bot_directory, behavior)` | `given_render_instructions_exist(bot_directory, behavior)` |
| `then_action_uses_class(action_obj, class_type)` | `then_action_uses_instructions_class(action_obj)`, `then_action_uses_merged_instructions_class(action_obj)` |
| `given_environment_and_base_instructions(bot_directory, workspace_directory)` | `given_environment_and_base_instructions(bot_directory, workspace_directory)` |
| `when_bot_created(bot_name, bot_directory, bot_config)` | `when_create_bot_with_config(bot_name, bot_directory, bot_config)` |
| `then_state_file_does_not_exist(workspace_directory)` | `then_behavior_action_state_does_not_exist(workspace_directory)` |
| `then_result_action_matches(result, expected_action)` | `then_result_action_matches_expected(result, expected_action)` |
| `given_action_config_dict(instructions=None, string_instructions=None, none_instructions=False)` | `given_base_action_config_with_instructions(instructions)`, `given_base_action_config_with_string_instructions(instructions)`, `given_base_action_config_with_none_instructions()` |
| `given_behavior_instructions_dict(instructions=None)` | `given_behavior_with_instructions(instructions)`, `given_behavior_with_non_dict_instructions()` |
| `when_instructions_created(base_action_config, behavior)` | `when_instructions_instantiated(base_action_config, behavior)` |
| `then_instructions_match(result, expected=None, type=None, merged=None, base=None, behavior=None)` | `then_base_instructions_are(result, expected)`, `then_behavior_instructions_are(result, expected)`, `then_merged_contains_base_instructions(merged, expected)`, `then_merged_contains_behavior_instructions(merged, expected)`, `then_merged_instructions_list_contains_all(merged, base, behavior)`, `then_merged_instructions_list_equals(merged, expected)` |

## INIT PROJECT Sub-Epic

| New Consolidated Function | Existing Functions (comma-delimited) |
|--------------------------|--------------------------------------|
| `given_environment_variable_set(variable_name, value)` | `given_bot_directory_environment_variable_set(bot_directory)`, `given_workspace_directory_environment_variable_set(workspace_directory)`, `given_legacy_working_dir_environment_variable_set(workspace_directory)`, `given_workspace_area_and_working_dir_environment_variables_set(workspace_area, working_dir)`, `given_bot_directory_and_workspace_area_environment_variables_set(bot_directory, workspace_directory)` |
| `then_workspace_directory_matches(workspace_directory_path, expected, different=None)` | `then_workspace_directory_equals_expected_and_not_different(workspace_directory_path, expected, different)` |
| `then_environment_variables_not_set(*variable_names)` | `then_environment_variables_not_set(*variable_names)` |
| `then_directories_match(bot_directory_result, workspace_directory_result, expected_bot_directory, expected_workspace_directory)` | `then_bot_and_workspace_directories_match_expected(bot_directory_result, workspace_directory_result, expected_bot_directory, expected_workspace_directory)`, `then_bot_has_correct_directories(bot, expected_bot_directory, expected_workspace_directory)` |
| `then_file_location_matches(workflow_file, expected_parent, expected_name)` | `then_workflow_file_location_is_correct(workflow_file, expected_parent, expected_name)` |
| `then_bot_config_matches(bot, expected_bot_name=None, expected_behaviors=None)` | `then_bot_config_loaded_correctly(bot, expected_bot_name, expected_behaviors)` |
| `then_behavior_folder_matches(behavior_folder, expected_path)` | `then_behavior_folder_resolved_correctly(behavior_folder, expected_path)` |
| `then_function_returns_same_value(function, expected_value, call_count=3)` | `then_multiple_calls_return_same_value(function, expected_value, call_count)` |
| `given_override_directory(temp_workspace, directory_name, set_env=False)` | `given_override_workspace_directory_created_and_set(temp_workspace, workspace_name)`, `given_different_directory_created(temp_workspace, directory_name)` |
| `then_bot_config_field_missing(bot_directory, field)` | `then_bot_config_does_not_have_working_area(bot_directory)` |
| `when_bootstrap_logic_runs(bot_directory, condition=None)` | `when_entry_point_bootstrap_logic_runs_if_working_area_not_set(bot_directory)`, `when_entry_point_bootstraps_from_bot_config(bot_directory)` |
| `then_environment_variable_matches(variable_name, expected_value, different_value=None)` | `then_workspace_area_environment_variable_equals_expected_and_not_different(expected_value, different_value)`, `then_environment_variable_is_set(variable_name, expected_value)` |
| `given_bot_config_and_behavior(bot_directory, bot_name, behavior_name)` | `given_bot_config_and_behavior_exist(bot_directory, bot_name, behavior_name)` |
| `when_bot_instantiated(bot_name, bot_directory, config_path)` | `when_bot_is_instantiated(bot_name, bot_directory, config_path)` |
| `then_function_returns_path(function, expected_path)` | `then_function_returns_path(function, expected_path)` |

## EXECUTE BEHAVIOR ACTIONS Epic (Shared)

| New Consolidated Function | Existing Functions (comma-delimited) |
|--------------------------|--------------------------------------|
| `then_workflow_current_state_matches(workflow, expected_state)` | `then_workflow_current_state_is(workflow, expected_state)` |
| `then_completed_actions_match(workflow_file, expected_action_states)` | `then_completed_actions_include(workflow_file, expected_action_states)` |
| `given_action_initialized(bot_directory, workspace_directory, action_type, bot_name='story_bot', behavior='exploration', create_story_graph=True)` | `given_environment_bootstrapped_and_action_initialized(bot_directory, workspace_directory, action_type, bot_name, behavior, create_story_graph)` |

