{
  "actionName": "render_output",
  "instructions": [
    "**MANDATORY: Before rendering any output, you MUST load and review the project's clarification.json and planning.json files from `{project_area}/{docs_path}/`. The docs_path is specified in the behavior's configuration files (typically `docs/stories/` for story_bot). These files contain critical requirements, decisions, and context that MUST be reflected in all rendered artifacts.**",
    "",
    "**CRITICAL: Load planning.json and check for the current behavior's section (e.g., 'shape', 'discovery', 'exploration', 'specification'). Reference decisions_made and assumptions_made for the current behavior, as well as any previous behaviors that affect this work.**",
    "",
    "**CRITICAL: CONTENT.JSON PARSING - MANDATORY:**",
    "",
    "1. Load and parse `{bot}/behaviors/{behavior}/2_content/2_render/{output_name}.json` (or {bot}/behaviors/{behavior}/*_content/*_render/{output_name}.json if numbered differently) - these files define ALL outputs that must be rendered",
    "2. Parse ALL entries in each {output_name}.json file to identify all templates that need to be run",
    "3. Each output entry specifies: name, path, template, and instructions",
    "4. Process ALL outputs defined in 2_render/*.json files - do not skip any",
    "",
    "**CRITICAL: Run ALL templates and ALL builders in this action**",
    "",
    "**BUILDER PATTERN - MANDATORY:**",
    "For each builder specified in 2_render/{output_name}.json:",
    "1. Load the builder config JSON from `{bot}/behaviors/{behavior}/2_content/2_render/{output_name}.json` (or {bot}/behaviors/{behavior}/*_content/*_render/{output_name}.json if numbered differently)",
    "2. The config JSON specifies: name, path, template, builder, and output",
    "3. Run the builder Python file: `{bot}/behaviors/{behavior}/2_content/2_render/templates/{builder}` (or {bot}/behaviors/{behavior}/*_content/*_render/templates/{builder} if numbered differently)",
    "4. Pass the builder config JSON path and project_path to the builder",
    "5. Builder reads: template/config (from 2_render/{output_name}.json) → project input data (from project docs) → generates → project output (to project path specified in config)",
    "6. Pattern: template/config JSON → builder → project input data → project output file",
    "",
    "**BUILDER EXECUTION:**",
    "1. For each {output_name}.json in 2_render/ (or *_render/ if numbered differently) that has a 'builder' field:",
    "   - Load {output_name}.json to get builder config",
    "   - Find builder file at: {bot}/behaviors/{behavior}/2_content/2_render/templates/{builder} (or {bot}/behaviors/{behavior}/*_content/*_render/templates/{builder} if numbered differently)",
    "   - Execute: python {builder_file} {output_name}.json {project_path}",
    "   - Builder reads project input from project_path/docs/ (as specified in knowledge_graph.json)",
    "   - Builder writes output to project_path/{path}/{output} (as specified in {output_name}.json)",
    "2. Run ALL builder files in `{bot}/behaviors/{behavior}/2_content/2_render/templates/*builder*.py` (or {bot}/behaviors/{behavior}/*_content/*_render/templates/*builder*.py if numbered differently)",
    "3. Run any template files (markdown, DrawIO, JSON, etc.) that do NOT have a builder specified",
    "4. Process both template-based rendering AND builder-based generation",
    "",
    "Transform the structured content into rendered artifacts using available templates or builders.",
    "",
    "**Output Instructions:**",
    "{{output_instructions}}  --> load from all {bot}/behaviors/{behavior}/2_content/2_render/{output_name}.json (or {bot}/behaviors/{behavior}/*_content/*_render/{output_name}.json if numbered differently)",
    "",
    "**SYNCHRONIZATION SCRIPTS - MANDATORY:**",
    "After rendering is complete and user confirms ready to proceed:",
    "1. Synchronize configuration is automatically loaded and injected into instructions by render_output action",
    "2. Access synchronize configuration from injected instructions:",
    "   a. synchronize_instructions: General sync instructions from 3_synchronize/instructions.json (if exists)",
    "   b. synchronize_configs: Array of all synchronize_*.json configuration files with loaded templates",
    "3. For each synchronize_config entry:",
    "   - config: The synchronize_*.json configuration (name, description, scripts, templates, instructions)",
    "   - templates: Dictionary of loaded template files (key=template_path, value=template_content)",
    "   - file: Path to the synchronize_*.json file",
    "4. For each synchronize_*.json configuration:",
    "   - Read the 'scripts' array to identify sync scripts to execute",
    "   - Each script entry specifies: name, renderer, renderer_command, description, and parameters",
    "   - Execute sync scripts using the specified renderer (e.g., story_io synchronize command)",
    "   - Use loaded templates from 'templates' dictionary if specified in config 'templates' array",
    "   - Templates are file-based (not code/builders) - use template content directly for formatting/rules",
    "   - Follow the pattern: sync config JSON → project data → sync output",
    "5. Wait for user confirmation that render is complete before running sync scripts",
    "6. Report sync results to user",
    "",
    "**MANDATORY: PAUSE FOR HUMAN FEEDBACK**",
    "When this action is complete, AI MUST pause and wait for human feedback. When human says 'done' or confirms completion, you MUST proceed to the next step: **validate_rules** (call the validate_rules action tool)."
  ]
}


