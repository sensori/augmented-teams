{
  "instructions": [
    "**MANDATORY: Before validating any content, you MUST load and review the project's context files:**",
    "1. Load `{project_area}/docs/stories/clarification.json` - Contains key questions and evidence (generated file)",
    "2. Load `{project_area}/docs/stories/planning.json` - Contains assumptions and decisions (generated file)",
    "3. Load `{project_area}/docs/context/input.txt` (or similar) - Original input/source material if needed for validation (original context)",
    "",
    "**CRITICAL: File locations:**",
    "- **Generated files:** `{project_area}/docs/stories/clarification.json`, `{project_area}/docs/stories/planning.json`",
    "- **Original input:** `{project_area}/docs/context/input.txt` and other original context files",
    "",
    "These files contain critical requirements, decisions, and context that MUST be checked against during validation.",
    "",
    "**CRITICAL: Load planning.json and check for the current behavior's section (e.g., 'shape', 'discovery', 'exploration', 'specification'). Reference decisions_made and assumptions_made for the current behavior, as well as any previous behaviors that affect this work.**",
    "",
    "**Validation Parameters:**",
    "",
    "All validation parameters are documented here. Parameters can be combined (union).",
    "",
    "**Story/Epic/Increment Scope Parameters (for StoryScanner):**",
    "",
    "1. **story_names** - Validate specific stories by name:",
    "   ```json",
    "   {",
    "     \"story_names\": [\"Select And Capture Tokens\", \"Group Tokens And Create Mob Entity\", \"Associate Tokens And Persist Mob\"]",
    "   }",
    "   ```",
    "",
    "2. **increment_priorities** - Validate stories in specific increments (by priority number):",
    "   ```json",
    "   {",
    "     \"increment_priorities\": [1, 2]",
    "   }",
    "   ```",
    "",
    "3. **epic_names** - Validate stories in specific epics:",
    "   ```json",
    "   {",
    "     \"epic_names\": [\"Manage Mobs\", \"Execute Mob Actions\"]",
    "   }",
    "   ```",
    "",
    "4. **validate_all** - Validate all stories (no filtering):",
    "   ```json",
    "   {",
    "     \"validate_all\": true",
    "   }",
    "   ```",
    "",
    "**File Validation Parameters (for TestScanner and CodeScanner):**",
    "",
    "5. **test** - Validate test files (single file or list of test file paths, for TestScanner):",
    "   ```json",
    "   {",
    "     \"test\": \"path/to/test_file.py\"",
    "   }",
    "   ```",
    "   Or multiple files:",
    "   ```json",
    "   {",
    "     \"test\": [\"path/to/test_file1.py\", \"path/to/test_file2.py\"]",
    "   }",
    "   ```",
    "",
    "6. **src** - Validate source code files (list of source code file paths, for CodeScanner):",
    "   ```json",
    "   {",
    "     \"src\": [\"path/to/source_file1.py\", \"path/to/source_file2.py\"]",
    "   }",
    "   ```",
    "",
    "",
    "**Combined Parameters:**",
    "Multiple parameter types can be combined (union):",
    "   ```json",
    "   {",
    "     \"increment_priorities\": [1],",
    "     \"epic_names\": [\"Manage Mobs\"],",
    "     \"test\": [\"path/to/test_file1.py\", \"path/to/test_file2.py\"]",
    "   }",
    "   ```",
    "",
    "**Default Behavior:**",
    "- If no scope parameters are provided, validation processes **all stories**",
    "- When scope is specified, stories not in scope are skipped (no violations reported)",
    "- File parameters (test, src) are REQUIRED for their respective behaviors (see sections below)",
    "- If file parameters are not provided, auto-discovery will attempt to find files in the workspace",
    "",
    "**Example MCP tool calls:**",
    "```python",
    "# Validate specific stories",
    "mcp_story-bot_scenarios(",
    "    action='validate_rules',",
    "    parameters={",
    "        'story_names': ['Select And Capture Tokens', 'Group Tokens And Create Mob Entity']",
    "    }",
    ")",
    "",
    "# Validate increment 1 and 2",
    "mcp_story-bot_scenarios(",
    "    action='validate_rules',",
    "    parameters={",
    "        'increment_priorities': [1, 2]",
    "    }",
    ")",
    "",
    "# Validate multiple epics",
    "mcp_story-bot_scenarios(",
    "    action='validate_rules',",
    "    parameters={",
    "        'epic_names': ['Manage Mobs', 'Execute Mob Actions']",
    "    }",
    ")",
    "",
    "# Validate specific test file",
    "mcp_story-bot_tests(",
    "    action='validate_rules',",
    "    parameters={",
    "        'test': 'path/to/test_file.py'",
    "    }",
    ")",
    "",
    "# Validate multiple test files",
    "mcp_story-bot_tests(",
    "    action='validate_rules',",
    "    parameters={",
    "        'test': ['path/to/test_file1.py', 'path/to/test_file2.py']",
    "    }",
    ")",
    "",
    "# Validate multiple code files (for code behavior)",
    "mcp_story-bot_code(",
    "    action='validate_rules',",
    "    parameters={",
    "        'src': ['path/to/source_file1.py', 'path/to/source_file2.py']",
    "    }",
    ")",
    "```",
    "",
    "**Instructions:**",
    "1. Load and review `{project_area}/docs/stories/clarification.json` and `{project_area}/docs/stories/planning.json` to understand all requirements and decisions",
    "2. Check planning.json for the current behavior's decisions_made and assumptions_made sections",
    "3. Evaluate the Content Data against all rules listed above",
    "4. Check for violations of each rule",
    "5. Verify that Content Data incorporates all requirements from clarification.json and planning.json (especially the current behavior's decisions_made and assumptions_made)",
    "6. Generate a validation report with:",
    "   - List of all violations found (if any)",
    "   - Specific examples from the Content Data that violate rules",
    "   - Any missing requirements from clarification.json or planning.json (including stage-specific decisions/assumptions)",
    "   - Recommendations for fixing violations",
    "7. If no violations found, confirm that Content Data follows all rules and incorporates all requirements",
    "8. **MANDATORY: Save the validation report to a file**",
    "   - File name: `validation-report.md`",
    "   - Location: `{project_area}/{docs_path}/validation-report.md` (validation report goes in docs_path, NOT in context folder)",
    "   - Note: Generated context files (clarification.json, planning.json) are in `{project_area}/docs/stories/`, and validation report is also output to `{project_area}/{docs_path}/`",
    "   - Format: Markdown with sections for Status, Violations Found, Suggested Corrections",
    "   - Include: Total documents validated, violations count, rules checked count, summary",
    "   - After generating the report, write it to the file using standard file writing operations",
    "",
    "**CRITICAL: Verb-Noun Format Validation:**",
    "When checking verb-noun format for story/epic names:",
    "- Verb-noun format means [Verb] [Noun] structure - the verb can be in various forms (imperative 'Add', infinitive 'To Add', third person 'Adds')",
    "- DO NOT suggest pluralizing nouns unless the original is clearly grammatically incorrect",
    "- DO NOT remove important prepositional phrases or context from the noun part (e.g., 'Add Minion To Mob' is correct - don't suggest removing 'To Mob')",
    "- The format is about structure (verb + noun), not about specific verb tense or noun number",
    "- Examples of CORRECT verb-noun format: 'Add Minion To Mob', 'Create Mob', 'Group Minions', 'Select Strategy'",
    "- Examples of INCORRECT: 'Mob Management' (noun-noun, no verb), 'Adding Minion' (gerund, not action verb), 'Minion Addition' (noun-noun)",
    "",
    "**CRITICAL: Story Context and Flow Validation:**",
    "- Story order and context come from sequential_order in the story graph - if sequential_order is present, the order/context is already specified",
    "- DO NOT flag stories as 'missing context' if they have sequential_order - the order provides the context (when/why/outcome comes from position in sequence)",
    "- Flow validation (end-to-end user-system behavior, one interaction/response) will be handled in discovery phase - DO NOT flag these as violations in shape phase",
    "- In shape phase, focus on: naming format, domain concepts, story structure - NOT detailed flow/context which comes in discovery",
    "",
    "**CRITICAL: Code File Validation - REQUIRED FOR CODE BEHAVIOR:**",
    "",
    "**MANDATORY: When validating rules for code behavior, you MUST discover and pass code files as parameters.**",
    "",
    "**YOU MUST:**",
    "1. **Discover code files** by searching the workspace for source files:",
    "   - Search in: {project_area}/src/, {project_area}/agile_bot/bots/base_bot/src/",
    "   - Find all *.py files (excluding test files)",
    "   - Collect the full paths to these files",
    "",
    "2. **Pass code files using the src parameter** (see parameter documentation above):",
    "   - Use the `src` parameter format shown in the parameters section",
    "   - Pass all discovered code files as a list",
    "",
    "3. **If you cannot discover code files** (directories don't exist, no code files found, or unclear which files to validate):",
    "   - **STOP and ASK the user:** \"Which code files should I validate? Please provide the file paths.\"",
    "   - **DO NOT proceed without code files** - CodeScanner requires code files to scan",
    "   - **DO NOT assume** - always ask if uncertain",
    "",
    "**Why this is required:**",
    "- CodeScanner instances need code file paths to scan for violations",
    "- Without src parameter, CodeScanner will not run and code validation rules will be skipped",
    "- Code files can be passed explicitly, or auto-discovery will attempt to find them in the workspace",
    "",
    "**CRITICAL: Test File Validation - REQUIRED FOR TESTS BEHAVIOR:**",
    "",
    "**MANDATORY: When validating rules for tests behavior, you MUST discover and pass test files as parameters.**",
    "",
    "**YOU MUST:**",
    "1. **Discover test files** by searching the workspace for test files:",
    "   - Search in: {project_area}/test/, {project_area}/tests/, and {project_area}/agile_bot/bots/base_bot/test/",
    "   - Find all files matching pattern: test_*.py",
    "   - Collect the full paths to these files",
    "",
    "2. **Pass test files using the test parameter** (see parameter documentation above):",
    "   - Use the `test` parameter format shown in the parameters section",
    "   - Pass all discovered test files as a list",
    "",
    "3. **If you cannot discover test files** (directories don't exist, no test files found, or unclear which files to validate):",
    "   - **STOP and ASK the user:** \"Which test files should I validate? Please provide the file paths.\"",
    "   - **DO NOT proceed without test files** - TestScanner requires test files to scan",
    "   - **DO NOT assume** - always ask if uncertain",
    "",
    "**Why this is required:**",
    "- TestScanner instances need test file paths to scan for violations",
    "- Without test parameter, TestScanner will not run and test validation rules will be skipped",
    "- Test files can be passed explicitly, or auto-discovery will attempt to find them in the workspace",
    "",
    "**Scope considerations:**",
    "- If user specifies story_names, epic_names, or increment_priorities in scope, you should still pass ALL discovered test files",
    "- The scanners will filter violations based on scope, but all test files should be scanned",
    "- If user wants to validate only specific test files, they will pass test parameter explicitly",
    "",
    "**AUTOMATIC PROGRESSION: Once validation is complete and all violations are fixed (if any), automatically proceed to render_output action without stopping or waiting for user confirmation. These two actions should execute sequentially as a single workflow step.**"
  ]
}

