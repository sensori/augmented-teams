{
  "behaviorName": "specification_tests",
  "description": "Generate executable test code from scenarios/examples",
  "goal": "Create automated tests that validate story behavior",
  "inputs": "Scenarios from specification_scenarios or examples from specification_examples",
  "outputs": "Test files (.py, .js, etc.) with executable test code",
  "baseActionsPath": "agile_bot/bots/base_bot/base_actions",
  "instructions": [
    "**BEHAVIOR WORKFLOW INSTRUCTIONS:**",
     "Perform each instruction action as specified in base_actions, tweaked for the specification_tests behavior.",
    "",
    "**CRITICAL RULE - TESTS MUST MATCH STORY GRAPH EXACTLY:**",
    "",
    "See agile_bot/bots/story_bot/behaviors/8_tests/rules/tests_must_match_story_graph_exactly.json for complete rule with examples.",
    "",
    "**Summary of required exact matches:**",
    "",
    "1. **Test file name = Sub-epic name (snake_case)**",
    "   - Format: test_<sub_epic_name>.py",
    "   - Example: 'Generate Bot Server And Tools' -> test_generate_bot_server_and_tools.py",
    "   - WRONG: test_increment_3_*, test_story_*, abbreviated names",
    "",
    "2. **Test class name = EXACT Story name (PascalCase)**",
    "   - Format: class Test<ExactStoryName>:",
    "   - Example: 'Generate Bot Tools' -> class TestGenerateBotTools:",
    "   - Example: 'Inject Guardrails as Part of Clarify Requirements' -> class TestInjectGuardrailsAsPartOfClarifyRequirements:",
    "   - WRONG: Abbreviated (TestGenTools), Generic (TestGuardrailsInjection), Reworded",
    "",
    "3. **Test method name = Scenario name (snake_case)**",
    "   - Format: def test_<scenario_name_snake_case>(self, fixtures):",
    "   - Example: 'Generator creates bot tool for test_bot' -> def test_generator_creates_bot_tool_for_test_bot()",
    "   - WRONG: Abbreviated, generic, numbered (test_scenario_1)",
    "",
    "4. **Test class ordering = Story map sequence**",
    "   - Test classes appear in SAME order as stories in story map",
    "   - File reads like story map: first story -> first class, second story -> second class",
    "   - Makes navigation trivial: find story in map -> go to same position in test file",
    "",
    "5. **Helper functions placement:**",
    "   - Helpers MUST be inline in the test file (not separate shared file)",
    "   - Helpers should be as local as possible to the tests using them",
    "   - Only truly reusable helpers go in conftest.py",
    "",
    "5. **Consistent scenario language:**",
    "   - Use 'Given: a bot with name' pattern (not 'Given: bot named')",
    "   - Use 'When: Generator processes Bot Config' pattern",
    "   - Use 'Then: Generator creates X tool instances' pattern",
    "   - Match exact language from story scenarios",
    "",
    "**MAPPING TESTS TO STORY GRAPH:**",
    "",
    "After creating test files, classes, and methods, you MUST map them to the story-graph.json:",
    "",
    "1. **test_file field** - Add to sub-epic level:",
    "   - Format: \"test_file\": \"test_<sub_epic_name>.py\"",
    "   - Example: \"test_file\": \"test_generate_bot_server_and_tools.py\"",
    "   - Maps to the sub-epic that contains the stories being tested",
    "",
    "2. **test_class field** - Add to story level (when applicable):",
    "   - Format: \"test_class\": \"Test<ExactStoryName>\"",
    "   - Example: \"test_class\": \"TestGenerateBotTools\"",
    "   - Only add if the test file contains a test class (not standalone functions)",
    "   - Maps to the exact story name that the test class validates",
    "",
    "3. **test_method field** - Add to scenario level:",
    "   - Format: \"test_method\": \"test_<scenario_name_snake_case>\"",
    "   - Example: \"test_method\": \"test_generator_creates_bot_tool_for_test_bot\"",
    "   - Maps to the exact scenario name that the test method validates",
    "",
    "**Important:**",
    "- Update story-graph.json to include these mappings after test creation",
    "- Ensure all test files, classes, and methods are properly mapped to their corresponding story graph elements",
    "- If a test file has no test classes (only standalone functions), omit test_class field",
    "- Every scenario should have its corresponding test_method mapped",
    "",
    "**Action Sequence:**",
    "**NOTE: Action order and action-specific instructions are determined by the actions_workflow section below. Always check that section for the correct sequence and instructions.**",
    "",
    "**Workflow Control:**",
    "- **STOP for human feedback** when told to stop or when action requires user input",
    "- **CONTINUE to next action** when told to proceed",
    "- **STOP when complete** when all actions are finished"
  ],
  "actions_workflow": {
    "actions": [
      {
        "name": "build_knowledge",
        "order": 3,
        "next_action": "render_output",
        "instructions": [
          "Follow agile_bot/bots/base_bot/base_actions/3_build_knowledge/instructions.json, specification_tests: build test implementations AND refine domain model based on test implementation details",
          "Refine domain model concepts, relationships, and responsibilities based on test implementation patterns and requirements"
        ]
      },
      {
        "name": "render_output",
        "order": 4,
        "next_action": "validate_rules",
        "instructions": [
          "Follow agile_bot/bots/base_bot/base_actions/5_render_output/instructions.json, specification_tests: render test code files",
          "After rendering test files, update story-graph.json with test_file, test_class, and test_method mappings"
        ]
      },
      {
        "name": "validate_rules",
        "order": 5,
        "action_class": "agile_bot.bots.story_bot.src.bot.validate_code_files_action.ValidateCodeFilesAction",
        "instructions": [
          "Follow agile_bot/bots/base_bot/base_actions/4_validate_rules/instructions.json, specification_tests: validate test code AND domain model refinements",
          "Validate that all test files, classes, and methods are properly mapped to story-graph.json"
        ]
      }
    ]
  },
  "trigger_words": {
    "description": "Behavior-level trigger words - specific to specification tests/test code generation behavior",
    "patterns": [
      "generate.*test.*code",
      "create.*test.*file",
      "write.*pytest.*tests",
      "implement.*step.*definitions",
      "generate.*acceptance.*tests",
      "create.*bdd.*tests",
      "write.*test.*code",
      "generate.*test.*implementation",
      "create.*test.*cases",
      "implement.*feature.*tests",
      "specification.*tests",
      "test.*code.*generation",
      "bdd.*test.*code"
    ],
    "priority": 14
  }
}

























