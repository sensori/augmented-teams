{
  "behaviorName": "code",
  "description": "Write production code to make all tests pass",
  "goal": "Implement production code that satisfies all test requirements and makes tests pass",
  "inputs": "Test files with failing tests, story-graph.json with test mappings",
  "outputs": "Production source code files that make tests pass",
  "baseActionsPath": "agile_bot/bots/base_bot/base_actions",
  "instructions": [
    "**BEHAVIOR WORKFLOW INSTRUCTIONS:**",
    "",
    "**CRITICAL PURPOSE - WRITE CODE TO MAKE TESTS PASS:**",
    "",
    "The code behavior is responsible for writing production code that makes all tests pass. Tests have already been created/updated in the tests behavior (7_write_tests). Your job is to implement the production code that satisfies those tests.",
    "",
    "**MANDATORY STEPS:**",
    "",
    "1. **Discover all test files** that have been created or updated:",
    "   - Find all test files in {project_area}/test/ or {project_area}/tests/",
    "   - Check story-graph.json for test_file mappings to identify which tests exist",
    "   - Review test files to understand what code needs to be implemented",
    "",
    "2. **Run tests to see what's failing:**",
    "   - Execute test suite (e.g., pytest, npm test) to identify failing tests",
    "   - Document which tests are failing and why (missing code, wrong implementation, etc.)",
    "",
    "3. **Write production code to make tests pass:**",
    "   - Implement the minimum code necessary to make each test pass",
    "   - Follow Test-Driven Development (TDD) principles:",
    "     * Tests define the API and expected behavior",
    "     * Write code to satisfy the test requirements",
    "     * Don't over-engineer - implement what tests require",
    "   - Use the test code as executable documentation of expected behavior",
    "   - Match the API design implied by the test code",
    "",
    "4. **Verify all tests pass:**",
    "   - Run the test suite again after implementing code",
    "   - Ensure all tests pass (green)",
    "   - If tests still fail, iterate: fix code, run tests, repeat until green",
    "",
    "5. **Follow clean code principles:**",
    "   - Write clean, readable, maintainable code",
    "   - Follow SOLID principles",
    "   - Use meaningful names",
    "   - Keep functions small and focused",
    "   - Apply all clean code rules from 3_rules/ folder",
    "",
    "**TEST-DRIVEN DEVELOPMENT APPROACH:**",
    "",
    "- **Tests are the specification** - they define what the code should do",
    "- **Tests define the API** - function names, parameters, return values come from tests",
    "- **Implement incrementally** - make one test pass, then move to the next",
    "- **Don't write code that isn't tested** - if there's no test for it, don't implement it",
    "- **Refactor after tests pass** - once green, improve code quality while keeping tests passing",
    "",
    "**CODE ORGANIZATION:**",
    "",
    "- Place production code in appropriate source directories (e.g., {project_area}/src/)",
    "- Match the structure implied by test imports and module paths",
    "- Create modules, classes, and functions as required by the tests",
    "",
    "**Action Sequence:**",
    "**NOTE: Action order and action-specific instructions are determined by the actions_workflow section below. Always check that section for the correct sequence and instructions.**",
    "",
    "**Workflow Control:**",
    "- **STOP for human feedback** when told to stop or when action requires user input",
    "- **CONTINUE to next action** when told to proceed",
    "- **STOP when complete** when all tests pass and code is implemented"
  ],
  "actions_workflow": {
    "actions": [
      {
        "name": "build_knowledge",
        "order": 3,
        "next_action": "render_output",
        "instructions": [
          "Follow agile_bot/bots/base_bot/base_actions/3_build_knowledge/instructions.json",
          "**CODE-SPECIFIC:** Discover all test files and analyze what production code needs to be implemented:",
          "1. Find all test files in {project_area}/test/ or {project_area}/tests/",
          "2. Review test_file mappings in story-graph.json",
          "3. Analyze test code to understand:",
          "   - What modules/classes/functions need to be created",
          "   - What APIs are expected (function signatures, return types)",
          "   - What behavior is required (from test assertions and scenarios)",
          "4. Run tests to identify current failures",
          "5. Document what code needs to be written to make tests pass"
        ]
      },
      {
        "name": "render_output",
        "order": 4,
        "next_action": "validate_rules",
        "instructions": [
          "Follow agile_bot/bots/base_bot/base_actions/5_render_output/instructions.json",
          "**CODE-SPECIFIC:** Write production code to make all tests pass:",
          "1. Implement production code files based on test requirements",
          "2. Write minimum code necessary to make each test pass",
          "3. Follow the API design implied by test code",
          "4. Place code in appropriate source directories (e.g., {project_area}/src/)",
          "5. Run tests after implementing code to verify they pass",
          "6. Iterate: fix code, run tests, repeat until all tests are green",
          "7. Apply clean code principles from 3_rules/ folder while implementing"
        ]
      },
      {
        "name": "validate_rules",
        "order": 5,
        "action_class": "agile_bot.bots.story_bot.src.bot.validate_code_files_action.ValidateCodeFilesAction",
        "instructions": [
          "Follow agile_bot/bots/base_bot/base_actions/4_validate_rules/instructions.json",
          "**CODE-SPECIFIC:** Validate that production code meets quality standards:",
          "1. Validate source code files against clean code rules in 3_rules/",
          "2. Ensure all tests pass (run test suite and verify)",
          "3. Check code quality: naming, structure, SOLID principles, etc.",
          "4. Verify code matches test expectations and API design",
          "5. Report any violations and fix them"
        ]
      }
    ]
  },
  "trigger_words": {
    "description": "Agent-level trigger words - terms that indicate when to write production code to make tests pass",
    "patterns": [
      "write.*code",
      "implement.*code",
      "make.*tests.*pass",
      "implement.*production.*code",
      "write.*production.*code",
      "code.*implementation",
      "implement.*to.*pass.*tests",
      "write.*code.*for.*tests",
      "implement.*from.*tests",
      "tdd.*implementation",
      "red.*green.*refactor",
      "implement.*failing.*tests",
      "write.*code.*to.*pass",
      "code.*behavior",
      "implement.*code.*behavior"
    ],
    "priority": 5
  }
}







