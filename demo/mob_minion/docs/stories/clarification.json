{
  "1_shape": {
    "key_questions": {
      "user_types": "Game Masters (GMs) running Foundry VTT sessions who manage multiple minion tokens and need efficient control over groups of minions during combat.",
      "user_goals": "Control multiple minions as a single unit (mob) instead of individually. Click one minion token to command the entire mob. Select strategies for mob behavior (attack most powerful target, attack weakest target, defend leader, attack most damaged person).",
      "primary_users": "Game Masters using Foundry VTT who manage combat encounters with multiple minions.",
      "first_action": "Create a mob by grouping existing minion tokens together.",
      "problems_eliminated": "Eliminates the need to click on every individual minion token to perform actions. Currently, GMs must select each minion separately to command them, which is time-consuming during combat.",
      "struggle_points": "During combat encounters when managing multiple minions - having to individually select and command each minion token slows down gameplay.",
      "integrations": "Foundry VTT core system (token management, actor system), Foundry VTT combat system (for executing actions), Foundry VTT movement/range system (for movement and area attacks), Actor/token system (for grouping minions into mobs).",
      "integration_behaviors": "Mob creation depends on Foundry's actor/token system to identify and group minions. Strategy execution depends on Foundry's combat system to determine targets and execute attacks. Movement/range mechanics depend on Foundry's grid/movement system for positioning and area attacks.",
      "business_domain": "Virtual tabletop game combat management - specifically minion group management within Foundry VTT.",
      "core_concepts": "Minion: Individual game entity/token. Mob: Collection of minions that act together. Strategy: Behavioral rules for mob actions (attack strongest, attack weakest, defend leader, attack most damaged). Mob Template: Predefined mob configurations. Target Selection: Method for choosing which enemy to attack. Attack Method: How the mob executes attacks (ranged, melee, area attacks).",
      "sub_domains": "Mob Management (create, edit, group minions), Strategy Selection (choose mob behavior patterns), Target Selection (determine which enemies to attack), Action Execution (perform attacks, movement, area attacks), Mob Spawning (create mobs from actor templates).",
      "domain_boundaries": "Mob creation/editing vs. mob action execution. Strategy definition vs. strategy application. Individual minion control vs. mob control. Foundry VTT core functionality vs. this extension functionality.",
      "domain_events": "Mob created, Minions grouped into mob, Strategy selected, Target chosen, Mob action executed (attack, move, area attack), Mob spawned from template.",
      "business_rules": "A mob is a collection of minions that act together. Clicking any minion in a mob commands the entire mob. Strategies determine target selection and behavior. Must work within Foundry VTT's existing systems. Game has range mechanics requiring movement. Area attacks affect multiple targets.",
      "domain_language": "Mob (collection of minions), Minion (individual token/actor), Strategy (behavioral pattern), Target selection (choosing enemies), Area attack (attacking multiple targets), Spawn (create from template), Token (visual representation on map), Actor (game entity data)."
    },
    "evidence": {
      "user_input": "I want to start a new project around handling minions within a role playing game virtual tabletop system most of the functionality is already there so this is just a small piece of functionality that's going to allow me to turn minions into mobs a mod would be defined as a collection of minions that can act together so I don't have to click on every token of every minion to get them to do something I just click on any one of the minions and they'll all perform the same actions Another big idea with this is once I've grouped minions into mobs I can select a strategy and the strategy could be attack the most powerful target Attack the weakest target I think I have some other strategies in the green there like defend the leader you know attack the most damaged person so all the strategies are those green stickiness you see and then underneath that you've got like a really high level you could almost call it a story map but it's got some things like editing mobs so how do I create a mob how do I group people to mobs Spawn mobs from a couple actors could I have mock templates choose targets different ways of choosing a target different ways of attacking this is a game system that has range merely the person would have to move to the other person area attack the fleeing part I don't really care about key to this system is that it's going to work within the Foundry virtual tabletop system so you have to be writing any initial shaping we do with stories around using their system and stuff",
      "high_level_features": "Mob creation, grouping minions, strategies, target selection, attack methods, mob templates, spawning from actors"
    }
  },
  "2_prioritization": {
    "key_questions": {
      "risk_areas": "Create Mob (foundational - if this fails, nothing else works. Risk: Foundry VTT integration complexity), Execute Mob Actions (core value delivery - if actions don't work, feature fails. Risk: coordinating multiple minions through Foundry's combat system), Select Strategy (moderate risk - target selection logic complexity)",
      "value_areas": "Create Mob + Execute Mob Actions (delivers core value proposition - click one token to command all minions, solves main problem of time-consuming individual token management), Select Strategy (adds value but secondary to basic mob control)",
      "complexity_areas": "Execute Mob Actions (most complex - target selection, combat system integration, movement/range mechanics, but highest value), Select Strategy (moderate complexity - target selection algorithms, moderate value), Spawn Mob From Template (lower complexity, lower value - convenience feature)",
      "thin_slices": "Yes - thin slices should be as end-to-end as possible. First increment should allow creating a mob and executing a basic action (like attack) to demonstrate value quickly",
      "reusable_components": "Mob entity/collection management (reused across Create, Edit, Execute, Spawn), Foundry Token API integration (reused across all features), Foundry Combat System integration (reused in Execute Actions and potentially Strategy selection), Strategy/Target Selection logic (reused in Execute Actions)",
      "project_constraints": "No explicit constraints found in context. User input needed for deadlines, Foundry VTT version requirements, or other constraints",
      "user_groups": "Game Masters are the primary users - no other user groups identified. All features target GMs managing combat encounters"
    },
    "evidence": {
      "story_map": "Story graph with 1 epic (Manage Mobs) containing 5 sub-epics: Create Mob, Edit Mob, Select Strategy, Execute Mob Actions, Spawn Mob From Template. Total 18 estimated stories.",
      "clarification_data": "User types: Game Masters running Foundry VTT sessions. Primary goal: Control multiple minions as single unit. First action: Create mob by grouping tokens. Problems eliminated: Time-consuming individual token management."
    }
  },
  "4_discovery": {
    "key_questions": {
      "increment_scope": "Increment 1: 'Create and Command Mobs' includes Create Mob (3 stories: Select Multiple Tokens, Group Tokens Into Mob, Display Mob Creation Confirmation) and Execute Mob Actions (3 stories: Click Mob Token To Command, Determine Target From Strategy, Execute Attack Action). Total: 6 stories delivering end-to-end mob creation and basic command functionality.",
      "major_workflows": "Mob Creation Workflow: Game Master selects multiple minion tokens \u2192 Groups them into mob entity \u2192 Confirms creation. Mob Command Workflow: Game Master clicks any mob token \u2192 System identifies mob and determines target \u2192 Executes attack for all minions in mob",
      "systems_roles": "Systems: Foundry VTT core system (token management API, actor system, combat system). Roles: Game Master (primary user). Teams: Single development team building Foundry VTT module/extension",
      "story_groupings": "Capability 1: Create Mob - Groups 3 sequential stories for mob creation. Capability 2: Execute Mob Actions - Groups 3 sequential stories for commanding mobs",
      "story_sequence": "Create Mob stories are sequential: Select Multiple Tokens (1) \u2192 Group Tokens Into Mob (2) \u2192 Display Mob Creation Confirmation (3). Execute Mob Actions stories are sequential: Click Mob Token To Command (1) \u2192 Determine Target From Strategy (2) \u2192 Execute Attack Action (3). Dependency: Execute Mob Actions depends on Create Mob (mobs must exist before they can be commanded)",
      "integration_points": "Integration Point 1: Foundry Token API - Token selection and identification. Integration Point 2: Foundry Actor System - Mob entity creation and persistence. Integration Point 3: Foundry Combat System - Target determination and attack execution. Transition Point: Between Create Mob and Execute Mob Actions (mob entity must be persisted and accessible)",
      "dependencies": "Execute Mob Actions depends on Create Mob being completed first (mobs must exist before commanding). Within Create Mob: stories are sequential dependencies. Within Execute Mob Actions: stories are sequential dependencies. Determine Target From Strategy may need a default strategy if no strategy is assigned (increment 1 may not include strategy selection)"
    },
    "evidence": {
      "increment_definition": "Increment 1: Create and Command Mobs (Priority 1) - 6 stories total: Create Mob (3 stories), Execute Mob Actions (3 stories)",
      "story_map": "Story graph with Manage Mobs epic containing Create Mob and Execute Mob Actions sub-epics",
      "clarification_data": "User types: Game Masters. Primary goal: Control multiple minions as single unit. Integrations: Foundry VTT token management, actor system, combat system"
    }
  },
  "5_exploration": {
    "key_questions": {
      "increment": "Increment 1: Create and Command Mobs (Priority 1) - 6 stories across Create Mob and Execute Mob Actions capabilities",
      "overarching_outcome": "Enable Game Masters to efficiently manage groups of minions by creating mobs and commanding them with a single click, eliminating the need to individually select and command each minion token during combat",
      "first_user_action": "Select multiple minion tokens on Foundry canvas to initiate mob creation",
      "system_reactions": "User selects tokens \u2192 System validates (at least one token), returns token objects via Foundry Token API. User initiates mob creation \u2192 System creates Mob entity, links tokens via Foundry Actor System. User confirms \u2192 System persists mob. User clicks mob token \u2192 System identifies mob. System determines target \u2192 Uses strategy (or default) via Foundry Combat System. User executes attack \u2192 System executes for all minions via Foundry Combat System",
      "behavioral_domain_criteria": "Yes, but may need expansion. Current AC focus on behavioral interactions. Domain criteria (mob must contain at least one minion, mob entity structure, token-mob relationships) should be explicitly captured",
      "user_system_handoffs": "Create Mob: User selects \u2192 System validates \u2192 User initiates \u2192 System creates \u2192 System displays \u2192 User confirms \u2192 System persists. Execute Actions: User clicks \u2192 System identifies \u2192 System determines target \u2192 User selects action \u2192 System executes",
      "unknowns_edge_cases": "Unknown: How to handle Determine Target From Strategy when no strategy assigned (Increment 1 doesnt include strategy selection) - may need default behavior. Edge cases: Token already belongs to another mob, invalid token selection, mob with zero tokens, target out of range. Domain complexity: Foundry API integration patterns, mob entity persistence structure, coordinating multiple minion actions",
      "domain_rules": "A mob must contain at least one minion (if last token removed, mob is deleted). Clicking any token in a mob commands the entire mob. Must work within Foundry VTT existing systems. All minions in a mob execute the same action",
      "split_merge_stories": "Stories appear appropriately sized. Each has 2-3 acceptance criteria. May need to add more AC for edge cases and domain rules, but current granularity seems right",
      "increment_size": "No, 6 stories is appropriate for an end-to-end increment. Delivers core value (create and command) and is testable as a unit",
      "acceptance_criteria_count": "3-5 acceptance criteria per story seems right. Current stories have 2-3 AC; should add edge cases and domain validation to reach 3-5",
      "first_ac_walkthrough": "Review first AC: WHEN Game Master selects multiple minion tokens on Foundry canvas, THEN Foundry Token API returns array of selected token objects - validates integration point and expected system response",
      "integration_coordination": "Foundry Token API integration - Token selection and identification (Create Mob). Foundry Actor System integration - Mob entity creation and persistence (Create Mob, Execute Actions). Foundry Combat System integration - Target determination and attack execution (Execute Actions)",
      "technical_uncertainty": "Determine Target From Strategy - Complex if no strategy assigned; may need default target selection logic. Foundry API integration - Uncertainty around exact API patterns may require proof-of-concept. Coordinating multiple minion actions - Architectural complexity in executing synchronized actions"
    },
    "evidence": {
      "increment_definition": "Increment 1: Create and Command Mobs - 6 stories (Create Mob: 3 stories, Execute Mob Actions: 3 stories)",
      "story_map": "Story graph with Manage Mobs epic containing Create Mob and Execute Mob Actions sub-epics with detailed acceptance criteria",
      "discovery_data": "Workflows identified: Mob Creation Flow and Mob Command Flow. Integration points: Foundry Token API, Actor System, Combat System"
    }
  },
  "6_scenarios": {
    "key_questions": {
      "system_user_actions": "**Answer:** For Increment 1 stories:\n\n**Create Mob Flow:**\n- User: Game Master selects multiple minion tokens on Foundry canvas\n- System: Foundry Token API returns array of selected token objects\n- User: Game Master initiates mob creation\n- System: Creates new Mob entity containing selected tokens\n- System: Links all tokens to mob entity via Foundry Token API\n- System: Displays confirmation dialog showing mob name and token count\n- User: Game Master confirms mob creation\n- System: Persists mob in Foundry actor system\n\n**Execute Mob Actions Flow:**\n- User: Game Master clicks any token belonging to mob\n- System: Identifies mob associated with clicked token\n- System: Prepares to execute action for all minions in mob\n- System: Uses mob's assigned strategy (or default) to determine target\n- System: Selects appropriate enemy based on strategy rules using Foundry combat system\n- User: Game Master selects attack action\n- System: Executes attack for all minions in mob via Foundry combat system\n- System: All minions perform attack action against selected target",
      "system_responses": "**Answer:** After each user action:\n\n1. **Token Selection:** System validates selection (at least one token required), returns token objects array, or shows error if zero tokens selected\n\n2. **Mob Creation Initiation:** System creates Mob entity, links tokens via Foundry Token API, stores token IDs and actor IDs\n\n3. **Mob Creation Confirmation:** System displays confirmation dialog with mob name and token count, waits for user confirmation\n\n4. **Confirmation:** System persists mob in Foundry actor system, or discards mob entity if cancelled\n\n5. **Token Click:** System identifies mob associated with clicked token, prepares action execution for all minions\n\n6. **Target Determination:** System uses strategy (or default) to select target via Foundry combat system\n\n7. **Attack Execution:** System executes attacks for all minions, updates combat tracker with results",
      "preconditions": "**Answer:** Preconditions required:\n\n**For Create Mob stories:**\n- Foundry VTT session must be active\n- Minion tokens must exist on Foundry canvas\n- Game Master must have permission to select tokens\n- Foundry Token API must be accessible\n- Foundry Actor System must be available for persistence\n\n**For Execute Mob Actions stories:**\n- At least one mob must exist (depends on Create Mob being completed)\n- Mob must contain at least one minion token\n- Foundry Combat System must be active/available\n- Target enemies must exist in combat encounter\n- Foundry Token API must be accessible to identify mob from token\n\n**Data States:**\n- Tokens must be valid Foundry token objects\n- Tokens should not already belong to another mob (or system handles conflict)\n- Mob entity structure must be defined (token IDs, actor IDs, strategy reference)",
      "success_criteria": "**Answer:** Success criteria from domain and user perspective:\n\n**Domain Success Criteria:**\n- Mob entity is successfully created and persisted\n- All tokens are correctly linked to mob entity\n- Mob can be identified from any of its tokens\n- All minions in mob execute the same action\n- Strategy-based target selection works correctly\n- Integration with Foundry systems functions without breaking existing functionality\n\n**User Success Criteria:**\n- Game Master can create a mob by selecting multiple tokens\n- Game Master can command entire mob with single click\n- Mob executes coordinated actions (all minions attack same target)\n- System eliminates need to individually select and command each minion token\n- Combat encounters with multiple minions can be managed efficiently",
      "alternate_flows": "**Answer:** Expected alternate flows, error paths, and edge cases:\n\n**Alternate Flows:**\n- User cancels mob creation (mob entity discarded, tokens remain ungrouped)\n- User selects tokens that already belong to another mob (system identifies conflict, prompts resolution)\n- Mob has no strategy assigned (system uses default strategy - nearest enemy or first available)\n- Clicked token does not belong to any mob (system treats as individual minion, no mob action)\n\n**Error Paths:**\n- Zero tokens selected \u2192 Error message: \"at least one token must be selected\"\n- Invalid token selection \u2192 System validation error\n- Foundry API failure \u2192 Error handling for integration failures\n- Mob creation fails \u2192 Error message, tokens remain ungrouped\n- Target determination fails \u2192 Fallback to default target or error\n- Attack execution fails \u2192 Error handling, partial execution possible\n\n**Edge Cases:**\n- Token already belongs to another mob (conflict resolution)\n- Last token removed from mob (mob entity deleted)\n- Mob with zero tokens (invalid state, should not exist)\n- Target out of range (handled in future increment with movement)\n- No enemies available (target selection failure)",
      "sequencing_constraints": "**Answer:** Mandatory sequencing constraints:\n\n**Within Create Mob:**\n- Select Multiple Tokens (1) \u2192 Group Tokens Into Mob (2) \u2192 Display Mob Creation Confirmation (3) - Sequential dependencies\n\n**Within Execute Mob Actions:**\n- Click Mob Token To Command (1) \u2192 Determine Target From Strategy (2) \u2192 Execute Attack Action (3) - Sequential dependencies\n\n**Across Stories:**\n- Execute Mob Actions depends on Create Mob being completed first (mobs must exist before they can be commanded)\n- Determine Target From Strategy may need default behavior if no strategy assigned (Increment 1 doesn't include strategy selection)\n\n**Story Group Dependencies:**\n- Create Mob capability must complete before Execute Mob Actions can begin\n- All stories within each capability group are sequential (AND connector)",
      "domain_rules": "**Answer:** Domain rules, calculations, and business policies:\n\n**Domain Rules:**\n- A mob must contain at least one minion (if last token removed, mob is deleted)\n- Clicking any token in a mob commands the entire mob\n- All minions in a mob execute the same action\n- Must work within Foundry VTT's existing systems without breaking functionality\n- Mob entity stores references to token IDs and actor IDs\n\n**Calculations/Business Policies:**\n- Target selection based on strategy rules (e.g., most powerful = highest power/level, weakest = lowest power/level)\n- Strategy evaluation uses Foundry combat system to assess enemy attributes\n- Token-to-mob relationship validation (tokens can only belong to one mob)\n- Mob persistence structure (token IDs, actor IDs, strategy reference)\n\n**Validation Rules:**\n- At least one token must be selected for mob creation\n- Tokens must be valid Foundry token objects\n- Mob entity must be valid before persistence",
      "testability": "**Answer:** Story testability:\n\n**Independent Testability:**\n- Each story can be tested independently with proper setup\n- Setup: Mock Foundry Token API, Actor System, Combat System\n- Teardown: Clean up test mobs, reset token states\n\n**Setup Conditions:**\n- Foundry VTT test environment with mock APIs\n- Test tokens created on canvas\n- Mock combat system with test enemies\n- Test mob entities in actor system\n\n**Teardown Conditions:**\n- Remove test mobs from actor system\n- Reset token states (remove mob associations)\n- Clean up test data\n\n**Test Isolation:**\n- Stories can be tested in isolation with mocked dependencies\n- Integration tests validate Foundry API interactions\n- Unit tests validate business logic (mob creation, target selection)",
      "external_systems": "**Answer:** External systems and services:\n\n**Foundry VTT Core Systems:**\n1. **Foundry Token API** - Token selection, identification, token-to-actor relationships\n2. **Foundry Actor System** - Mob entity persistence, actor data storage\n3. **Foundry Combat System** - Target determination, enemy evaluation, attack execution\n4. **Foundry Movement/Range System** - (Referenced but not used in Increment 1)\n\n**Integration Points:**\n- Token selection via Foundry Token API\n- Mob persistence via Foundry Actor System\n- Target selection via Foundry Combat System\n- Attack execution via Foundry Combat System",
      "system_contracts": "**Answer:** Requests, responses, and contracts:\n\n**Foundry Token API Contracts:**\n- Request: Get selected tokens \u2192 Response: Array of token objects with IDs, actor references\n- Request: Link tokens to mob \u2192 Response: Success/failure status\n- Request: Identify mob from token \u2192 Response: Mob entity or null\n\n**Foundry Actor System Contracts:**\n- Request: Create mob entity \u2192 Response: Mob entity with ID, token references\n- Request: Persist mob \u2192 Response: Success/failure, persisted mob data\n- Request: Retrieve mob \u2192 Response: Mob entity data\n\n**Foundry Combat System Contracts:**\n- Request: Get available enemies \u2192 Response: Array of enemy entities with attributes\n- Request: Evaluate target based on strategy \u2192 Response: Selected target entity\n- Request: Execute attack for minion \u2192 Response: Attack result (hit/miss, damage)\n- Request: Update combat tracker \u2192 Response: Success/failure",
      "integration_validation": "**Answer:** Integration points requiring validation:\n\n**Integration Point 1: Foundry Token API**\n- Validate token selection returns correct token objects\n- Validate token-to-mob linking works correctly\n- Validate token identification from mob works\n- Simulate: Mock Foundry Token API responses\n\n**Integration Point 2: Foundry Actor System**\n- Validate mob entity creation and persistence\n- Validate mob retrieval works correctly\n- Validate mob deletion when last token removed\n- Simulate: Mock Foundry Actor System storage\n\n**Integration Point 3: Foundry Combat System**\n- Validate target selection based on strategy\n- Validate enemy attribute evaluation\n- Validate attack execution for multiple minions\n- Validate combat tracker updates\n- Simulate: Mock Foundry Combat System with test enemies",
      "failure_handling": "**Answer:** Failure, timeout, and retry handling:\n\n**Foundry Token API Failures:**\n- Token selection fails \u2192 Show error message, allow retry\n- Token linking fails \u2192 Rollback mob creation, show error\n- No retry logic needed (user-initiated actions)\n\n**Foundry Actor System Failures:**\n- Mob persistence fails \u2192 Show error, allow retry or cancel\n- Mob retrieval fails \u2192 Handle gracefully, treat as no mob\n- No automatic retries (user should retry manually)\n\n**Foundry Combat System Failures:**\n- Target selection fails \u2192 Fallback to default target or show error\n- Attack execution fails \u2192 Partial execution possible, log errors\n- Combat tracker update fails \u2192 Log error, continue execution\n\n**Timeout Handling:**\n- API calls timeout \u2192 Show error message, allow user retry\n- No automatic retries (Foundry is local system, timeouts unlikely)\n\n**General Error Handling:**\n- All errors should be user-friendly\n- Log technical details for debugging\n- Allow user to retry or cancel operations",
      "data_variations": "**Answer:** Data variations for test coverage:\n\n**Token Selection Variations:**\n- 1 token (minimum valid)\n- Multiple tokens (2, 5, 10)\n- Zero tokens (error case)\n- Tokens already in another mob (conflict case)\n- Invalid tokens (error case)\n\n**Mob Creation Variations:**\n- Single minion mob (boundary)\n- Multiple minion mob (typical)\n- Large mob (10+ minions) (boundary)\n- Mob with different actor types\n\n**Target Selection Variations:**\n- Strategy assigned (typical)\n- No strategy assigned (default behavior)\n- Multiple enemies available\n- Single enemy available\n- No enemies available (error case)\n\n**Attack Execution Variations:**\n- All minions succeed\n- Some minions succeed, some fail\n- All minions fail\n- Different attack types (if applicable)",
      "input_values": "**Answer:** Input values needed for testing:\n\n**Select Multiple Tokens:**\n- Input: Array of token IDs (empty, 1, multiple)\n- Input: Token objects with IDs and actor references\n\n**Group Tokens Into Mob:**\n- Input: Array of selected token objects\n- Input: Mob name (optional, may be auto-generated)\n\n**Determine Target From Strategy:**\n- Input: Mob entity with strategy reference\n- Input: Available enemies array from combat system\n- Input: Strategy type (or null for default)\n\n**Execute Attack Action:**\n- Input: Mob entity with minion tokens\n- Input: Selected target enemy\n- Input: Attack action type",
      "output_values": "**Answer:** Expected output values:\n\n**Select Multiple Tokens:**\n- Output: Array of token objects (with IDs, actor IDs)\n- Output: Error message if zero tokens\n\n**Group Tokens Into Mob:**\n- Output: Mob entity (with ID, token references, actor references)\n- Output: Success/failure status\n\n**Display Mob Creation Confirmation:**\n- Output: Confirmation dialog (mob name, token count)\n- Output: User confirmation/cancellation\n\n**Click Mob Token To Command:**\n- Output: Mob entity identified\n- Output: Action preparation status\n\n**Determine Target From Strategy:**\n- Output: Selected target enemy entity\n- Output: Target selection reason/strategy used\n\n**Execute Attack Action:**\n- Output: Attack results for each minion (hit/miss, damage)\n- Output: Combat tracker updates\n- Output: Success/failure status",
      "formulas_calculations": "**Answer:** Formulas and calculations requiring multiple data points:\n\n**Target Selection Calculations:**\n- **Most Powerful Target:** Evaluate all enemies, calculate power/level, select maximum\n  - Data points: Enemy power levels, enemy types, enemy stats\n  - Formula: max(enemy.powerLevel) or max(enemy.level)\n\n- **Weakest Target:** Evaluate all enemies, calculate power/level, select minimum\n  - Data points: Enemy power levels, enemy health, enemy stats\n  - Formula: min(enemy.powerLevel) or min(enemy.level)\n\n- **Most Damaged Target:** Evaluate all enemies, calculate damage taken, select maximum damage\n  - Data points: Enemy max health, enemy current health, damage taken\n  - Formula: max(enemy.maxHealth - enemy.currentHealth)\n\n**Mob Entity Calculations:**\n- Token count calculation: count(tokens)\n- Mob validation: mob.tokens.length >= 1\n\n**Note:** Increment 1 may use default strategy (nearest enemy) if strategy selection not yet implemented",
      "domain_entities": "**Answer:** Domain entities with named values to test:\n\n**Mob Entity:**\n- mob.id (unique identifier)\n- mob.name (mob name)\n- mob.tokenIds (array of token IDs)\n- mob.actorIds (array of actor IDs)\n- mob.strategy (strategy type or null)\n\n**Token Entity:**\n- token.id (Foundry token ID)\n- token.actorId (linked actor ID)\n- token.mobId (mob association, nullable)\n\n**Strategy Types (Named Values):**\n- \"AttackMostPowerful\"\n- \"AttackWeakest\"\n- \"DefendLeader\"\n- \"AttackMostDamaged\"\n- \"Default\" (fallback)\n\n**Enemy Entity (from Foundry Combat System):**\n- enemy.id\n- enemy.powerLevel (or level)\n- enemy.currentHealth\n- enemy.maxHealth\n- enemy.damageTaken (calculated)",
      "boundary_conditions": "**Answer:** Boundary conditions for each data point:\n\n**Token Count:**\n- Minimum: 1 token (valid mob)\n- Maximum: No explicit limit (test with 10, 50, 100)\n- Edge: 0 tokens (invalid, error)\n\n**Mob Size:**\n- Minimum: 1 minion (smallest valid mob)\n- Typical: 3-5 minions\n- Large: 10+ minions\n- Edge: Empty mob (invalid state)\n\n**Target Selection:**\n- Minimum: 1 enemy available\n- Typical: 2-5 enemies\n- Edge: 0 enemies (error case)\n- Edge: All enemies have same power level (tie-breaking needed)\n\n**Strategy Assignment:**\n- Assigned: Strategy type present\n- Unassigned: null/undefined (default behavior)\n\n**Attack Results:**\n- All succeed: 100% success rate\n- All fail: 0% success rate\n- Mixed: Partial success",
      "responsibility": "**Answer:** Responsibility for writing/validating examples:\n\n**Business Analyst (BA):**\n- Define acceptance criteria\n- Validate domain rules and business policies\n- Review scenario coverage\n\n**Developer (Dev):**\n- Write scenario step definitions\n- Implement test code\n- Validate technical integration points\n\n**Quality Assurance (QC):**\n- Review test scenarios for completeness\n- Validate edge cases and error paths\n- Execute manual testing\n- Validate Foundry VTT integration\n\n**Game Master (Domain Expert):**\n- Validate scenarios match real Foundry VTT usage\n- Review strategy logic correctness\n- Validate combat system integration\n\n**Typical Flow:** BA defines AC \u2192 Dev writes scenarios \u2192 QC validates \u2192 Domain expert reviews",
      "scenario_outlines": "**Answer:** Scenarios that should be converted to Scenario Outlines:\n\n**Yes, several scenarios benefit from Examples tables:**\n\n1. **Select Multiple Tokens** - Different token counts (1, 2, 5, 10, 0)\n2. **Group Tokens Into Mob** - Different mob sizes and token combinations\n3. **Determine Target From Strategy** - Different strategy types with various enemy configurations\n4. **Execute Attack Action** - Different attack outcomes (all succeed, all fail, mixed)\n\n**Scenario Outline Candidates:**\n- Token selection with varying counts\n- Mob creation with varying sizes\n- Target selection with different strategies and enemy configurations\n- Attack execution with different success rates\n\n**Benefits:**\n- Reduces duplication\n- Makes data variations explicit\n- Easier to add new test cases\n- Clearer test coverage visualization"
    },
    "evidence": {
      "acceptance_criteria": "**Available:** Acceptance criteria from Exploration stage:\n- Domain AC at feature level: Mob grouping, strategy association, coordinated actions\n- Behavioral AC at story level: All 6 stories have detailed WHEN/THEN acceptance criteria\n- Location: `create-and-command-mobs-exploration.md` and `story-graph.json`",
      "ux_flows": "**Available:** Low fidelity UX flows:\n- Mob Creation Workflow: Select tokens \u2192 Group \u2192 Confirm\n- Mob Command Workflow: Click token \u2192 Identify mob \u2192 Determine target \u2192 Execute attack\n- Location: Story maps and exploration documents",
      "domain_models": "**Available:** Domain models and ubiquitous language:\n- Domain model description: `mob-minion-domain-model-description.md`\n- Core concepts: Mob, Minion, Token, Strategy, Target Selection, Action\n- Domain rules and relationships documented\n- Ubiquitous language defined",
      "walkthroughs": "**Available:** Cross-functional walkthrough outputs:\n- Discovery workflow analysis\n- Integration point identification\n- Story sequence and dependencies documented\n- Location: Clarification data and exploration documents",
      "integration_contracts": "**Partially Available:** Integration contracts:\n- Foundry Token API usage documented\n- Foundry Actor System integration described\n- Foundry Combat System integration described\n- May need API mock specifications for testing",
      "behavior_diagrams": "**Available:** Behavior diagrams:\n- Story map diagrams (drawio files)\n- Story graph JSON structure\n- Workflow sequences documented\n- May benefit from sequence diagrams for detailed flows"
    }
  }
}